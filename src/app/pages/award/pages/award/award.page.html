<button nz-button nzSize="small"
  class="h-10 px-6 font-semibold text-blue-600 bg-white border-white mt-14 hover:text-blue-600 hover:border-blue-600 focus:border-blue-600 rounded-3xl"
  (click)="goBack()"><i nz-icon nzType="left"></i>Back</button>

<div class="relative py-12" nz-row [nzGutter]="40">

  <div nz-col nzFlex="auto">
    <div class="space-x-4">
      <nz-avatar nzSrc="/assets/mocks/trophy.png" class="bg-white border-2 border-gray-400" nzShape="circle">
      </nz-avatar>

      <nz-tag [nzColor]="'#BBD3F6'" class="text-black">Award</nz-tag>
      <nz-tag class="text-black" *ngIf="data.isCompleted(data.award$ | async)">Completed</nz-tag>
      <nz-tag [nzColor]="'#CBF6BB'" class="text-black" *ngIf="!data.isCompleted(data.award$ | async)">Available</nz-tag>
    </div>

    <h1 i18n>{{(data.award$ | async)?.name}}</h1>

    <div class="flex items-center space-x-4">
      <div>
        <i nz-icon nzType="calendar" class="pr-2" nzTheme="outline"></i>
        <span>{{(data.award$ | async)?.createdOn?.toDate() | date:'short'}}</span>
      </div>
    </div>

    <wen-tabs [tabs]="sections"></wen-tabs>
    <div class="w-full py-12">
      <router-outlet></router-outlet>
    </div>

  </div>

  <div class="space-y-4" nz-col nzFlex="430px" *ngIf="(isLoggedIn$ | async)">
    <nz-card nzTitle="Action" *ngIf="!data.isCompleted(data.award$ | async)">
      <button nz-button nzType="primary" nzBlock nzSize="large" (click)="showParticipateModal()"
        *ngIf="!loggedInMemberIsParticipant()">
        Participate</button>

      <button nz-button nzType="primary" nzBlock nzSize="large" *ngIf="loggedInMemberIsParticipant()">
        Cancel Participation</button>
    </nz-card>

    <nz-card nzTitle="Award">
      <p class="text-xl">{{(data.award$ | async)?.badge?.name}}</p>
      <p>{{(data.award$ | async)?.badge?.description}}</p>
    </nz-card>

    <nz-card nzTitle="Award Badge">
      <nz-avatar nzSrc="/assets/mocks/trophy.png" class="bg-white border-2 border-gray-400" nzShape="circle">
      </nz-avatar>
    </nz-card>

    <nz-card nzTitle="System Info">
      <p>
        Experience Points: {{getExperiencePointsPerBadge(data.award$ | async)}}
      </p>
      <p>
        Available badges: {{(data.award$ | async)?.badge?.count}}
      </p>
      <p>
        End Date: {{(data.award$ | async)?.endDate?.toDate() | date:'short'}}
      </p>
    </nz-card>

    <nz-card nzTitle="Owner">
      <div *ngFor="let g of data.owners$ | async">
        <nz-avatar nzIcon="user" nzSrc="/assets/mocks/default_avatar.jpg" class="mr-2">
        </nz-avatar>
        <span>@ {{ g.uid | truncate:[12] }}</span>
      </div>
    </nz-card>
  </div>
</div>

<nz-modal [(nzVisible)]="isSubmitParticipationModalVisible" nzTitle="Confirm your participation"
  (nzOnCancel)="handleParticipateCancel()" (nzOnOk)="participate()">
  <ng-container *nzModalContent>
    <p class="mb-2">The whole communication is now handled outside the platform, let the award creator know how to
      contact you.</p>
    <textarea nz-input placeholder="Provide description or link to your work." [formControl]="commentControl" rows="4"></textarea>
  </ng-container>
</nz-modal>
