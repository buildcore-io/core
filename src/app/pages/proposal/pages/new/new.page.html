<button nz-button class="mt-14" (click)="goBack()"><i nz-icon nzType="left"></i>Back</button>

<h1 class="mt-7" i18 n>New Proposal</h1>

<form nz-form nzLayout="vertical" [formGroup]="proposalForm">
  <div class="py-4" nz-row [nzGutter]="16">

    <div class="space-y-4" nz-col nzFlex="auto">
      <nz-card [nzBordered]="false" nzTitle="Proposal Info">
        <div class="space-y-4">
          <nz-radio-group nzButtonStyle="solid" [formControl]="selectedGroupControl">
            <label nz-radio-button [nzValue]="true">All Guardians</label>
            <label nz-radio-button [nzValue]="false">All Members</label>
          </nz-radio-group>
          <input nz-input placeholder="Title" [formControl]="nameControl" />
          <div class="flex flex-grow space-x-4">
            <nz-date-picker class="flex flex-grow" [nzDisabledDate]="disabledStartDate.bind(this)" nzShowTime
              nzFormat="yyyy-MM-dd HH:mm:ss" [formControl]="startControl" nzPlaceHolder="Start"
              (nzOnOpenChange)="handleStartOpenChange($event)">
            </nz-date-picker>
            <nz-date-picker class="flex flex-grow" #endDatePicker [nzDisabledDate]="disabledEndDate.bind(this)"
              nzShowTime nzFormat="yyyy-MM-dd HH:mm:ss" [formControl]="endControl" nzPlaceHolder="End"></nz-date-picker>
          </div>
          <textarea nz-input placeholder="Proposal description" rows="4"
            [formControl]="additionalInfoControl"></textarea>
          <ng-container *ngFor="let question of questions.controls; let i = index">
            <input nz-input placeholder="Question Title" [formControl]="gForm(question, 'text')" />
            <textarea nz-input placeholder="Question description" rows="4"
              [formControl]="gForm(question, 'additionalInfo')"></textarea>
          </ng-container>
        </div>
      </nz-card>

      <!-- <button nz-button nzType="primary" nzSize="small" type="button" (click)="addQuestion()"
    class="h-10 px-6 m-2 font-semibold text-white bg-blue-600 border-blue-600 hover:bg-blue-700 hover:border-blue-700 focus:bg-blue-700 focus:border-blue-700 rounded-3xl"
    i18n>Add Question</button>
            <button nz-button nzType="primary" nzSize="small" type="button" (click)="removeQuestion(i)"
            *ngIf="questions.controls.length > 1">Remove Question</button>-->

      <ng-container *ngFor="let question of questions.controls; let i = index">
        <ng-container *ngFor="let answer of getAnswers(question); let ii = index">
          <nz-card [nzBordered]="false" [nzTitle]="'Choice ' + (ii + 1)" [nzExtra]="actionsTpl">
            <div class="space-y-4">
              <input nz-input placeholder="Answer Text" [formControl]="gForm(answer, 'text')" />
              <textarea nz-input placeholder="Answer description" rows="4"
                [formControl]="gForm(answer, 'additionalInfo')"></textarea>
            </div>
          </nz-card>
          <ng-template #actionsTpl>
            <div class="space-x-4">
              <nz-input-number [nzMin]="0" [nzMax]="250" placeholder="Answer Value"
                [formControl]="gForm(answer, 'value')">
              </nz-input-number>
              <button nz-button nzDanger nzType="text" nzShape="circle" *ngIf="getAnswers(question).length > 2"
                (click)="removeAnswer(question, ii)"><i nz-icon nzType="delete"></i></button>
            </div>
          </ng-template>
        </ng-container>
        <button nz-button nzType="default" nzSize="small" type="button" (click)="addAnswer(question)"
          *ngIf="getAnswers(question).length < 4"
          class="h-10 px-6 m-2 font-semibold text-white bg-blue-600 border-blue-600 hover:bg-blue-700 hover:border-blue-700 focus:bg-blue-700 focus:border-blue-700 rounded-3xl"
          i18n>Add Choice</button>
      </ng-container>

    </div>

    <div class="space-y-4" nz-col nzFlex="300px">
      <nz-card [nzBordered]="false" nzTitle="Space Info">
        <nz-select class="w-full" nzShowSearch nzAllowClear nzPlaceHolder="Select a space" [formControl]="spaceControl">
          <nz-option *ngFor="let s of spaces$ | async" [nzLabel]="s.name || s.uid" [nzValue]="s.uid"></nz-option>
        </nz-select>
      </nz-card>
    </div>
  </div>
</form>

<nz-divider></nz-divider>

<button nz-button nzType="primary" nzSize="large" type="button" (click)="create()" class="m-2 mb-8" i18n>Create
  Proposal</button>
