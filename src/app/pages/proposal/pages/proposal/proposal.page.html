<button nz-button nzSize="small"
  class="h-10 px-6 font-semibold text-blue-600 bg-white border-white mt-14 hover:text-blue-600 hover:border-blue-600 focus:border-blue-600 rounded-3xl"
  (click)="nav.goBack()"><i nz-icon nzType="left"></i>{{nav.getTitle()}}</button>

<div class="relative py-12" nz-row [nzGutter]="40">
  <div nz-col nzFlex="auto" style="max-width: calc(100% - 430px);">
    <div class="space-x-4">
      <nz-avatar nzSrc="/assets/mocks/default_avatar.jpg" class="bg-white border-2 border-gray-400" nzShape="circle">
      </nz-avatar>

      <nz-tag [nzColor]="'#BBD3F6'" class="text-black" *ngIf="(data.proposal$ | async)?.approved">Proposal</nz-tag>
      <nz-tag [nzColor]="'#CBF6BB'" class="text-black" *ngIf="!(data.proposal$ | async)?.approved">Draft</nz-tag>
      <nz-tag [nzColor]="'#f6c5bb'" class="text-black" *ngIf="(data.proposal$ | async)?.rejected">Rejected</nz-tag>
    </div>

    <h1 i18n>{{(data.proposal$ | async)?.name}}</h1>

    <div class="flex items-center space-x-4">
      <div>
        <i nz-icon nzType="calendar" class="pr-2" nzTheme="outline"></i>
        <span>{{(data.proposal$ | async)?.createdOn?.toDate() | date:'short'}}</span>
      </div>
      <div>
        <nz-avatar nzIcon="user" nzSrc="/assets/mocks/default_avatar.jpg" class="mr-2">
        </nz-avatar>
        <span>@{{(data.proposal$ | async)?.createdBy | truncate:[12]}}</span>
      </div>
    </div>

    <div class="w-full py-12">
      <router-outlet></router-outlet>
    </div>

  </div>

  <div class="space-y-4" nz-col nzFlex="430px">
    <nz-card nzTitle="Cast your vote" *ngIf="(data.proposal$ | async)?.approved && isNativeVote((data.proposal$ | async)?.type)">
      <button nz-button nzType="primary" nzBlock nzSize="large">
        Open Firefly to Vote</button>
      <h4 nz-typography class="pt-4">
        Voting instructions
      </h4>
      <p>Authoritatively disseminate prospective leadership via opportunities economically sound. </p>
    </nz-card>
    <nz-card nzTitle="Cast your vote"
             *ngIf="(data.proposal$ | async)?.approved && isMemberVote((data.proposal$ | async)?.type) && canVote(data.members$ | async)">

      <ng-container *ngFor="let q of (data.proposal$ | async)?.questions">
        <p>{{q.text}}</p>
        <nz-radio-group [formControl]="voteControl">
          <label nz-radio *ngFor="let a of q.answers" [nzValue]="a.value">{{a.text}}</label>
        </nz-radio-group>
      </ng-container>
      <button nz-button nzType="primary" nzBlock nzSize="large" (click)="vote()">
        Vote Now
      </button>
    </nz-card>

    <nz-card nzTitle="Approve Proposal" *ngIf="!(data.proposal$ | async)?.approved && (isGuardianWithinSpace$ | async)">
      <div class="space-y-4">
        <button nz-button nzType="primary" nzBlock nzSize="large" (click)="approve()">
          Approve</button>
        <button nz-button nzDanger nzType="primary" nzBlock nzSize="large" (click)="reject()">
          Decline</button>
      </div>
    </nz-card>

    <nz-card nzTitle="Current Results" *ngIf="(data.proposal$ | async)?.approved">
      <ng-container *ngFor="let q of (data.proposal$ | async)?.questions">
        <ng-container *ngFor="let a of q.answers">
          <p>{{a.text}}</p>
          <nz-progress [nzPercent]="getProgress(q, a, data.members$ | async)" nzStatus="active"></nz-progress>
        </ng-container>
      </ng-container>
    </nz-card>

    <nz-card nzTitle="Votes" *ngIf="(data.proposal$ | async)?.approved && isMemberVote((data.proposal$ | async)?.type)">
      <nz-table #basicTable [nzData]="(data.transactions$ | async) || []" [nzShowPagination]="false">
        <thead>
          <tr>
            <th>Voter</th>
            <th>Date</th>
            <th>Option</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of data.transactions$ | async">
            <td [routerLink]="['/member', t.member]"> @{{ t.member | truncate:[12] }}</td>
            <td>{{ t.createdOn?.toDate() | date:"short" }}</td>
            <td>{{ findAnswerText((data.proposal$ | async)?.questions, t.payload.values) }}</td>
          </tr>
        </tbody>
      </nz-table>
    </nz-card>

    <!-- MEMBER VOTE -->
    <nz-card nzTitle="System Info" *ngIf="isMemberVote((data.proposal$ | async)?.type)">
      <p>
        Star Date: {{(data.proposal$ | async)?.settings?.startDate?.toDate() | date:'short'}}
      </p>
      <p>
        End Date: {{(data.proposal$ | async)?.settings?.endDate?.toDate() | date:'short'}}
      </p>
    </nz-card>

    <!-- NATIVE VOTE -->
    <nz-card nzTitle="System Info" *ngIf="isNativeVote((data.proposal$ | async)?.type)">
      <p>
        milestoneIndexCommence: {{(data.proposal$ | async)?.settings?.milestoneIndexCommence}}
      </p>
      <p>
        milestoneIndexStart: {{(data.proposal$ | async)?.settings?.milestoneIndexCommence}}
      </p>
      <p>
        milestoneIndexEnd: {{(data.proposal$ | async)?.settings?.milestoneIndexEnd}}
      </p>
      <a nz-button nzType="link">Export to JSON</a>
    </nz-card>
  </div>
</div>
