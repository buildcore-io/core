<wen-content [showBackButton]="true">
    <div class="flex flex-col mt-12 lg:flex-row lg:mt-10">
        <div class="flex-grow w-full mt-10 lg:w-1/2 lg:mr-10">
            <nz-tag class="wen-status-tag bg-tag-blue border-tag-blue">NFT</nz-tag>
            <wen-collection-status [collection]="data.collection$ | async"></wen-collection-status>

            <h1 class="mt-2" i18n>{{ (data.nft$ | async)?.name }}</h1>

            <div class="flex items-center justify-between w-full h-12 p-4 bg-white rounded-xl" *ngIf="isDateInFuture((data.nft$ | async)?.availableFrom)">
                <div class="flex items-center mr-8"
                    [ngClass]="{ 'text-alerts-error': false }">
                        <wen-icon-time></wen-icon-time>
                        <div class="ml-2.5 font-bold" i18n>Sale Starts</div>
                </div>
                <div class="font-medium">
                  {{(data.nft$ | async)?.availableFrom?.toDate() | date:'short'}}
                </div>
            </div>

            <div class="flex flex-wrap items-center mt-5">
                <div class="flex-grow h-20 px-4 py-3 mr-3 bg-white w-3/10 rounded-xl">
                    <div class="text-xs font-medium text-foregrounds-secondary" i18n>Current price</div>
                    <div class="flex items-center mt-2">
                        <div class="text-lg font-bold truncate">{{data.formatBest((data.nft$ | async)?.price)}}</div>
                        <!-- <div class="ml-2 text-xs font-medium truncate text-foregrounds-secondary">{{100 $}}</div> -->
                    </div>
                </div>


                <div class="flex-grow h-20 px-4 py-3 mr-3 bg-white w-3/10 rounded-xl">
                    <div class="text-xs font-medium text-foregrounds-secondary" i18n>Author</div>
                    <div class="flex items-center mt-2">
                      <a [routerLink]="['/member', (data.creator$ | async)?.uid]" class="flex items-center">
                        <nz-avatar [nzSrc]="(data.creator$ | async)?.currentProfileImage | ipfsAvatar:filesizes.small"
                          class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                          style="max-width: 32px; min-width: 32px;" [nzSize]="32">
                        </nz-avatar>
                        <div class="ml-3 mr-8 text-base font-medium truncate max-w-24">
                          @{{((data.creator$ | async)?.name || (data.creator$ | async)?.uid) }}
                        </div>
                      </a>
                    </div>
                </div>

                <div class="flex-grow h-20 px-4 py-3 bg-white w-3/10 rounded-xl">
                    <div class="text-xs font-medium text-foregrounds-secondary" i18n>Space</div>
                    <a class="flex items-center mt-2">
                        <nz-avatar class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                            style="max-width: 32px; min-width: 32px;" [nzSize]="32"
                            [nzSrc]="avatarService.getAvatarSize((data.space$ | async)?.avatarUrl)">
                        </nz-avatar>

                        <div class="ml-3 mr-8 text-base font-medium truncate max-w-24">{{ (data.space$ | async)?.name || (data.space$ | async)?.uid }}</div>
                    </a>
                </div>
            </div>

            
            <!-- Needs to be implemented -->
            <div class="mt-6 p-5 rounded-xl bg-yellow flex items-center">
                <wen-icon-alert-octagon class="mr-2.5 lg:mr-3.5"></wen-icon-alert-octagon>
                <div class="text-base font-bold">
                    <span>{{ 10 }} </span>
                    <span i18n>remaining</span>
                </div>
            </div>

            <button nz-button nzType="primary" (click)="buy($event)" [disabled]="!(data.collection$ | async)?.approved" *ngIf="!(data.nft$ | async)?.owner" nzBlock nzSize="large" class="mt-10" i18n>
                Buy now
            </button>

            <!-- Use this if sale has ended -->
            <!-- <div *ngIf="false" class="flex items-center w-full px-5 py-4 mt-12 text-white bg-light-brown rounded-xl">
                <wen-icon-sad></wen-icon-sad>
                <div class="font-medium ml-3.5">
                    Sale ended
                </div>
            </div> -->

            <div class="mt-12 font-medium" [innerHtml]="(data.nft$ | async)?.description| markdown">
            </div>

            <!-- This should be used for timeline -->
            <!-- <wen-timeline class="block mt-12" [badges]="data.badges$ | async"></wen-timeline> -->
        </div>

        <div class="flex-grow w-full max-w-screen-sm lg:w-1/2">
            <div class="relative w-full overflow-hidden rounded-2xl">
                <img
                alt="NFT Image"
                [src]="(data.nft$ | async)?.media || '/assets/mocks/no_banner.jpg'"
                class="object-cover w-full h-full"
                />
            </div>

            <div class="flex flex-col items-center mt-8 lg:flex-row">
                <a nz-button nzType="default" (click)="null" nzBlock nzSize="default" target="_new" [href]="getShareUrl()"
                    class="flex items-center justify-center flex-grow w-full text-black lg:mr-4 lg:w-1/2">
                        <wen-icon-twitter></wen-icon-twitter>
                        <div class="ml-2.5 text-xs font-medium" i18n>Share</div>
                </a>
                <button nz-button nzType="default" (click)="null" nzBlock nzSize="default" (click)="copy()"
                    class="flex items-center justify-center flex-grow w-full text-black lg:w-1/2">
                        <wen-icon-copy></wen-icon-copy>
                        <div class="ml-2.5 text-xs font-medium" (click)="copy()" i18n>Copy to clipboard</div>
                </button>
            </div>

            <nz-card nzTitle="System info" class="mt-8">
                <div class="wen-description-item bg-bg-background">
                    <span nz-typography class="text-app-gray-400" i18n>Address</span>
                    <p nz-typography class="flex items-center">
                        Migrate to IOTA ... SOON

                        <wen-icon-question-circle
                            class="ml-2.5 text-app-gray-400"
                            nz-tooltip
                            i18n-nzTooltipTitle
                            nzTooltipTitle="The current address is not connected to a live mainnet. As soon as the functionality is supported on IOTA/Shimmer, you will have to ability to one-click migrate this NFT to your network of choice."
                        ></wen-icon-question-circle>
                    </p>
                </div>

                <div class="wen-description-item bg-bg-background">
                    <span nz-typography class="text-app-gray-400" i18n>IPFS Metadata</span>
                    <p nz-typography>
                        {{ (data.nft$ | async)?.ipfsMedia || 'Preparing...'}}
                    </p>
                </div>
            </nz-card>

            <nz-card nzTitle="Properties" class="mt-4" *ngIf="data.getPropStats((data.nft$ | async)?.properties).length">
                <div class="wen-description-item bg-bg-background"
                    *ngFor="let prop of data.getPropStats((data.nft$ | async)?.properties)">
                        <span nz-typography class="text-app-gray-400">{{ prop.label }}</span>
                        <p nz-typography>{{ prop.value }}</p>
                </div>
            </nz-card>

            <nz-card nzTitle="Stats" class="mt-4" *ngIf="data.getPropStats((data.nft$ | async)?.stats).length">
                <div class="wen-description-item bg-bg-background"
                    *ngFor="let stat of data.getPropStats((data.nft$ | async)?.stats)">
                        <span nz-typography class="text-app-gray-400">{{ stat.label }}</span>
                        <p nz-typography>{{ stat.value }}</p>
                </div>
            </nz-card>
        </div>
    </div>

    <div class="w-screen h-px mt-16 -ml-20 bg-app-gray-separator-dark lg:mt-12"></div>

    <nz-card class="relative block w-full mt-16" nzTitle="About the collection">
        <a nz-button nzType="link" class="absolute flex items-center right-6 top-6" [routerLink]="['/', collectionPath, (data.collection$ | async)?.uid]" nzSize="small">
            <span i18n>Show collection</span>
            <wen-icon-angle-right></wen-icon-angle-right>
        </a>

        <div class="flex justify-between">
            <div class="w-max">
                <h1 class="mb-2">{{ (data.collection$ | async)?.name || (data.collection$ | async)?.uid }}</h1>
                <div class="flex items-center">
                    <div class="mr-3 text-xs font-medium" i18n>by</div>

                    <ng-container *ngIf="(data.collection$ | async)?.space !== (data.collection$ | async)?.royaltiesSpace">
                      <nz-avatar class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                          style="max-width: 32px; min-width: 32px;" [nzSize]="32"
                          [nzSrc]="avatarService.getAvatarSize((data.space$ | async)?.avatarUrl)">
                      </nz-avatar>

                      <div class="ml-3 text-base font-medium truncate max-w-24">{{ (data.space$ | async)?.name || (data.space$ | async)?.uid }}</div>

                      <div class="mx-3 text-xs font-medium">/</div>

                      <nz-avatar class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                        style="max-width: 32px; min-width: 32px;" [nzSize]="32"
                        [nzSrc]="avatarService.getAvatarSize((data.royaltySpace$ | async)?.avatarUrl)">
                      </nz-avatar>

                      <div class="ml-3 text-base font-medium truncate max-w-24">{{ (data.royaltySpace$ | async)?.name || (data.royaltySpace$ | async)?.uid }}</div>
                    </ng-container>

                    <ng-container *ngIf="(data.collection$ | async)?.space === (data.collection$ | async)?.royaltiesSpace">
                      <nz-avatar class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                        style="max-width: 32px; min-width: 32px;" [nzSize]="32"
                        [nzSrc]="(data.collectionCreator$ | async)?.currentProfileImage | ipfsAvatar:filesizes.small">
                      </nz-avatar>

                      <div class="ml-3 text-base font-medium truncate max-w-24">@{{ (data.collectionCreator$ | async)?.name }}</div>

                      <div class="mx-3 text-xs font-medium">/</div>

                      <nz-avatar class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                          style="max-width: 32px; min-width: 32px;" [nzSize]="32"
                          [nzSrc]="avatarService.getAvatarSize((data.space$ | async)?.avatarUrl)">
                      </nz-avatar>

                      <div class="ml-3 text-base font-medium truncate max-w-24">{{ (data.space$ | async)?.name || (data.space$ | async)?.uid }}</div>
                    </ng-container>
                </div>
            </div>


            <div class="ml-20 text-xs font-medium" [innerHtml]="(data.collection$ | async)?.description | stripMarkdown"></div>
        </div>

        <div class="mt-10 lg:grid place-items-start">
            <div class="flex flex-wrap gap-6 mb-10">
                <nz-skeleton *ngIf="isLoading(data.topNftWithinCollection$ | async)" class="p-4 bg-white rounded-2xl w-76 h-76" [nzActive]="true"
                    [nzAvatar]="{ size: 'default' }" [nzParagraph]="{ rows: 1 }"></nz-skeleton>

                <nz-card class="w-76" *ngIf="isEmpty(data.topNftWithinCollection$ | async)">
                    <div class="flex flex-col justify-center text-center h-36">
                        <span class="leading-7 text-app-gray-400" i18n>
                            No NFTs
                        </span>
                    </div>
                </nz-card>

                <wen-nft-card class="wen-nft-card"
                    *ngFor="let nft of data.topNftWithinCollection$ | async; trackBy: trackByUid"
                    [nft]="nft" [collection]="(data.collection$ | async)">
                </wen-nft-card>
            </div>
        </div>
    </nz-card>
</wen-content>

<wen-nft-checkout [isOpen]="isCheckoutOpen" [nft]="data.nft$ | async" [collection]="data.collection$ | async" (onClose)="isCheckoutOpen = false"></wen-nft-checkout>
