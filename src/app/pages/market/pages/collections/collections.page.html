<ais-instantsearch [config]="config">
  <header class="header" id="header">
    <div class="header-searchbox">
      <wen-search-box [sections]="sections" [reset$]="reset$"></wen-search-box>
    </div>
  </header>
  <div class="relative mt-11 lg:mt-10">
    <ais-stats data-layout="mobile">
      <ng-template let-state="state">
        <span class="ais-Stats-text font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
          {{ state.nbHits | number }} <ng-container i18n>records</ng-container>
        </span>
      </ng-template>
    </ais-stats>
    <button class="wen-secondary absolute top-0 right-0 z-10" nz-button nzSize="small" (click)="openFilters = !openFilters">
      <wen-icon-collapse-arrow *ngIf="deviceService.isDesktop$ | async" [size]="16"
        class="transition-all mr-1" [ngClass]="{ 'rotate-180': !openFilters}"></wen-icon-collapse-arrow>
      <div i18n>Filters&Sort</div>
    </button>
  </div>
  <main class="flex mx-auto justify-between">
    <div class="container-results" [ngClass]="{ 'mr-5' : openFilters }">
      <ais-infinite-hits [transformItems]="convertAllToSoonaverseModel">
        <ng-template let-hits="hits" let-refine="showMore">
          <div class="mt-6 xl:grid place-items-start">
            <div class="mb-10 wen-cards-wrapper">
              <wen-collection-card class="w-full h-full outline-none"
                                   *ngFor="let hit of hits; trackBy: trackByUid"
                                   [collection]="hit"
                                   [fullWidth]="(deviceService.isMobile$ | async) || false">
              </wen-collection-card>
            </div>
          </div>
          <div (visible)="refine()"></div>
        </ng-template>
      </ais-infinite-hits>
    </div>

    <div class="container-filters overflow-hidden -translate-y-5 transition-all"
      *ngIf="(deviceService.isMobile$ | async) !== true"
      [ngClass]="openFilters ? 'max-w-screen-2xl ml-6' : 'max-w-0'">

      <wen-algolia-clear (wenOnClear)="reset$.next()"></wen-algolia-clear>

      <ng-container *ngTemplateOutlet="filters"></ng-container>
    </div>

    <nz-drawer *ngIf="deviceService.isMobile$ | async"
        [nzBodyStyle]="{ overflow: 'auto', padding: '20px' }"
        [nzWidth]="'100vw'" #drawer
        [nzClosable]="false"
        [nzVisible]="openFilters">
        <div *nzDrawerContent class="relative min-h-full h-max">
            <div class="pb-4 text-3xl font-bold" i18n>Filters&sort</div>
            <button class="absolute right-0 z-10 top-1" (click)="openFilters = false">
                <wen-icon-close></wen-icon-close>
            </button>

            <ng-container *ngTemplateOutlet="filters"></ng-container>
        </div>
    </nz-drawer>

    <ng-template #filters>
      <div class="container-body mt-8 lg:mt-6">
        <wen-collapse i18n-title title="Sort by" class="transition-all mb-2" [isCollapsed]="false"
          [type]="collapseTypes.UNDERLINE" (wenOnCollapse)="sortOpen = !$event" [ngClass]="{ 'mb-10': sortOpen }">
            <wen-sort-by
              [items]="sortItems"
            ></wen-sort-by>
        </wen-collapse>
        <wen-collapse i18n-title title="Saletype" class="transition-all mb-2" [isCollapsed]="false"
          [type]="collapseTypes.UNDERLINE" (wenOnCollapse)="saleFilterOpen = !$event" [ngClass]="{ 'mb-10': saleFilterOpen }">
            <wen-algolia-checkbox
              attribute="access"
              [transformItems]="algoliaService.convertToAccessName"
              [filterType]="algoliaCheckboxFilterTypes.SALE"
              [reset$]="reset$"
            >
            </wen-algolia-checkbox>
        </wen-collapse>
        <wen-collapse *ngIf="spacesLoaded$ | async" class="transition-all mb-2" i18n-title title="Spaces" [isCollapsed]="false"
          [type]="collapseTypes.UNDERLINE" (wenOnCollapse)="spaceFilterOpen = !$event" [ngClass]="{ 'mb-10': spaceFilterOpen }">
            <wen-algolia-checkbox
              attribute="space"
              [transformItems]="algoliaService.convertToSpaceName"
              [limit]="15"
              [showMoreLimit]="5"
              showMoreLabel="See more"
              showLessLabel="See less"
              [filterType]="algoliaCheckboxFilterTypes.SPACE"
              [reset$]="reset$"
            >
            </wen-algolia-checkbox>
        </wen-collapse>
        <wen-collapse class="transition-all mb-2" i18n-title title="Category" [isCollapsed]="true"
          [type]="collapseTypes.UNDERLINE" (wenOnCollapse)="categoryFilterOpen = !$event" [ngClass]="{ 'mb-10': categoryFilterOpen }">
            <wen-algolia-checkbox
              attribute="category"
              [transformItems]="algoliaService.convertCollectionCategory"
              [filterType]="algoliaCheckboxFilterTypes.DEFAULT"
              [reset$]="reset$"
            >
            </wen-algolia-checkbox>
        </wen-collapse>
        <wen-collapse class="transition-all mb-2" i18n-title title="Price range" [isCollapsed]="true"
          [type]="collapseTypes.UNDERLINE" (wenOnCollapse)="priceFilterOpen = !$event" [ngClass]="{ 'mb-10': priceFilterOpen || (deviceService.isMobile$ | async) }">
            <wen-algolia-range
              class="w-11/12 mx-auto"
              [reset$]="reset$">
            </wen-algolia-range>
        </wen-collapse>
        <div>
        </div>
      </div>
    </ng-template>
  </main>
</ais-instantsearch>
