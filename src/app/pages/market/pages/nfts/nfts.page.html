<ais-instantsearch [config]="config">
  <div class="container">
    <ais-hits-per-page
      class="container-option"
      [items]="paginationItems"
    >
    </ais-hits-per-page>

    <ais-sort-by
      class="container-option"
      [items]="sortItems"
    ></ais-sort-by>

    <ais-stats>
      <ng-template let-state="state">
        {{state.nbHits}} results found in {{state.processingTimeMS}} ms.
      </ng-template>
    </ais-stats>
  </div>

  <header class="header" id="header">
    <div class="header-searchbox">
      <wen-search-box [sections]="sections"></wen-search-box>
    </div>
  </header>
  <main class="container">

    <section class="container-results mr-10">
      <ais-hits [transformItems]="convertAllToSoonaverseModel">
        <ng-template let-hits="hits">

          <div class="mt-10 xl:grid place-items-start">

            <div class="wen-cards-wrapper mb-10" infiniteScroll [infiniteScrollDistance]="5" [infiniteScrollThrottle]="50"
            >

              <wen-nft-card class="outline-none w-full h-full"
                            *ngFor="let hit of hits; trackBy: trackByUid"
                            [nft]="hit"
                            [collection]="getCollection(hit.collection)"
              >
              </wen-nft-card>
            </div>
          </div>
        </ng-template>
      </ais-hits>

      <footer class="container-footer">
        <ais-pagination
          [padding]="2"
          [showFirst]="true"
          [showLast]="true"
        ></ais-pagination>
      </footer>
    </section>

    <div class="container-wrapper">
      <section class="container-filters">
        <div class="container-header">
          <h4>Filters&Sorts</h4>
          <wen-sort-by
            [items]="sortItems"
          ></wen-sort-by>
          <ais-clear-refinements
            class="clear-filters"
            data-layout="desktop"
            resetLabel="Clear filters"
          ></ais-clear-refinements>

          <ais-stats data-layout="mobile">
            <ng-template let-state="state">
              <span class="ais-Stats-text">
                <strong>{{ state.nbHits | number }}</strong> results in <strong>{{state.processingTimeMS}}</strong> ms.
              </span>
            </ng-template>
          </ais-stats>
        </div>

        <div class="container-body">

          <nz-collapse nzExpandIconPosition="right">
            <nz-collapse-panel
              nzHeader="Spaces"
              nzActive="true"
            >
              <ais-refinement-list
                attribute="space"
                [transformItems]="algoliaService.convertToSpaceName"
              >
              </ais-refinement-list>
            </nz-collapse-panel>
          </nz-collapse>
          <div>
          </div>
        </div>
      </section>
    </div>


  </main>


</ais-instantsearch>

<div class="flex flex-col items-end justify-between lg:flex-row">
  <wen-select-space
    *ngIf="deviceService.isMobile$ | async"
    class="block w-full mt-6 mb-6"
    [formControl]="spaceControl"
    [spaces]="getSpaceListOptions(cache.allSpaces$ | async)"
    size="large">
  </wen-select-space>

  <div class="flex items-end justify-between w-full lg:mt-12">
    <div class="flex items-center">
      <div>
        <div class="text-xs font-medium text-foregrounds-secondary mb-2" i18n>NFTs</div>
        <ng-container *ngIf="deviceService.isDesktop$ | async; else hotTagsMobileBlock">
          <nz-tag *ngFor="let tag of hotTags" nzMode="checkable" [nzChecked]="(selectedTags$ | async)!.indexOf(tag) > -1"
                  (nzCheckedChange)="handleChange(tag)">
            {{ hotTagsLabels[tag] }}
          </nz-tag>
        </ng-container>

        <ng-template #hotTagsMobileBlock>
          <nz-select class="w-fit wen-sort-button min-w-32" [ngModel]="hotTags[0]" (ngModelChange)="handleChange($event)">
            <nz-option *ngFor="let tag of hotTags" [nzLabel]="hotTagsLabels[tag]" [nzValue]="tag"></nz-option>
          </nz-select>
        </ng-template>
      </div>

      <div *ngIf="deviceService.isDesktop$ | async">
        <div class="text-xs font-medium text-foregrounds-secondary mb-2" i18n>Space</div>
        <wen-select-space
          class="block w-44"
          [formControl]="spaceControl"
          [spaces]="getSpaceListOptions(cache.allSpaces$ | async)"
          size="small">
        </wen-select-space>
      </div>
    </div>

    <ng-container *ngIf="deviceService.isDesktop$ | async; else sortMobileBlock">
      <nz-select class="wen-sort-button" i18n-nzPlaceHolder nzPlaceHolder="Sort by" [nzCustomTemplate]="defaultTemplate"
                 [formControl]="sortControl" nz-tooltip>
        <nz-option i18n-nzLabel nzLabel="Recent" [nzValue]="filter.sortOptions.RECENT"></nz-option>
        <nz-option i18n-nzLabel nzLabel="Low to High" [nzValue]="filter.sortOptions.PRICE_LOW"></nz-option>
        <nz-option i18n-nzLabel nzLabel="High to Low" [nzValue]="filter.sortOptions.PRICE_HIGH"></nz-option>
      </nz-select>
      <ng-template #defaultTemplate let-selected>
        <div class="flex items-center">
          <div nz-typography nzType="secondary" class="text-xs mr-1">
            <ng-container *ngIf="selected.nzValue === filter.sortOptions.RECENT; else notRecent" i18n>Sort by</ng-container>
            <ng-template #notRecent i18n>Price</ng-template>
          </div>
          <span>{{ selected.nzLabel }}</span>
        </div>
      </ng-template>
    </ng-container>
    <ng-template #sortMobileBlock>
      <div class="relative">
        <nz-select class="w-44 wen-sort-button" [formControl]="sortControl" nz-tooltip [nzSuffixIcon]="mobileSuffixIcon">
          <nz-option i18n-nzLabel nzLabel="Recent" [nzValue]="filter.sortOptions.RECENT"></nz-option>
          <nz-option i18n-nzLabel nzLabel="Low to High" [nzValue]="filter.sortOptions.PRICE_LOW"></nz-option>
          <nz-option i18n-nzLabel nzLabel="High to Low" [nzValue]="filter.sortOptions.PRICE_HIGH"></nz-option>
        </nz-select>
        <ng-template #mobileSuffixIcon>
          <wen-icon-sort class="absolute -ml-2" style="margin-top: -6px"></wen-icon-sort>
        </ng-template>
      </div>
    </ng-template>
  </div>
</div>

<div class="mt-10 lg:grid place-items-start">
    <p nz-typography nzType="secondary" class="mb-6 text-sm font-medium text-foregrounds-secondary" *ngIf="!isLoading(nfts$ | async)">
      {{ ((nfts$ | async)?.length || 0) + ((maxRecords$ | async) === false ? '+' : '') }} NFTs
    </p>
    <div class="wen-cards-wrapper mb-10" infiniteScroll [infiniteScrollDistance]="5" [infiniteScrollThrottle]="50"
        (scrolled)="onScroll()">

    <nz-skeleton *ngIf="isLoading(nfts$ | async)" class="p-4 bg-backgrounds-tertiary dark:bg-backgrounds-tertiary-dark rounded-2xl w-76 h-76" [nzActive]="true"
                 [nzAvatar]="{ size: 'default' }" [nzParagraph]="{ rows: 1 }"></nz-skeleton>

    <nz-card class="w-76" *ngIf="isEmpty(nfts$ | async)">
      <div class="flex flex-col justify-center text-center h-36">
                <span class="leading-7 text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                    No NFTs
                </span>
      </div>
    </nz-card>

    <!--    <wen-nft-card class="outline-none w-full h-full" [collection]="getCollection(nft.collection)"-->
    <!--                  *ngFor="let nft of nfts$ | async; trackBy: trackByUid" [nft]="nft">-->
    <!--    </wen-nft-card>-->
  </div>
</div>
