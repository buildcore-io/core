<!-- TODO find better hack for preventing header from jumping because of the scrollbar -->
<header class="fixed right-0 z-30 flex items-center justify-end w-full lg:absolute lg:py-5 lg:space-x-8 lg:w-header lg:pr-8 xl:pr-16">

  <ng-container *ngIf="deviceService.isMobile$ | async; else isDesktop">
    <wen-mobile-header
      class="absolute top-0 z-10 w-full p-4 transition-transform duration-300 transform -translate-y-1 bg-white shadow-header"
      [ngClass]="{
        '-translate-y-full -top-1 ': !isScrolled && (routerService.isHomeRoute$ | async),
        'shadow-none': !isScrolled && ((routerService.isHomeRoute$ | async) === false),
        'bg-tag-default': routerService.isNewRoute$ | async
      }"
      [isMemberProfile]="isMemberProfile"
      [isLandingPage]="isLandingPage"
      [isMobileMenuVisible]="isMobileMenuVisible"
      [isAllowedCreation]="isAllowedCreation"
      (onVisibleChange)="isMobileMenuVisible = !isMobileMenuVisible">
    </wen-mobile-header>

    <div class="p-4" *ngIf="!isScrolled">
      <button nz-button nz-dropdown nzType="default" nzShape="circle" nz-tooltip nzTooltipTitle="Coming SOON"
        nzTooltipPlacement="bottom" [nzDropdownMenu]="notificationMenu"
        [ngClass]="isMemberProfile ? 'bg-bg-background hover:bg-bg-background' : ''"
        class="inline-flex items-center justify-center border-0 wen-header-button">
        <wen-icon-bell class="text-app-gray-text"></wen-icon-bell>
      </button>

      <button nz-button nzShape="circle"
        class="inline-flex items-center justify-center ml-5 border-0 wen-header-button"
        type="button"
        (click)="isMobileMenuVisible = true">
        <wen-icon-menu></wen-icon-menu>
      </button>

    </div>
    <wen-mobile-menu
      [isVisible]="isMobileMenuVisible"
      [isMemberProfile]="isMemberProfile"
      [isLandingPage]="isLandingPage"
      [isAllowedCreation]="isAllowedCreation"
      [filesizes]="filesizes"
      (isVisibleChanged)="isMobileMenuVisible = $event">
    </wen-mobile-menu>
  </ng-container>


  <ng-template #isDesktop>
    <button nz-button *ngIf="isLandingPage" class="flex items-center gap-2 wen-header-button" [routerLink]="urlToDiscover"
      type="button" i18n>
      <wen-icon-rocket></wen-icon-rocket>Discover
    </button>

    <button nz-button nz-dropdown nzTrigger="click" [nzDropdownMenu]="createMenu" nz-tooltip nzTooltipPlacement="bottom"
      [nzTooltipTitle]="!isAllowedCreation ? 'To create a new space you must first earn a badge!' : undefined"
      *ngIf="(isLoggedIn$ | async) && !isMemberProfile && !isLandingPage" nzType="primary" type="button"
      class="flex items-center gap-2 pr-2" i18n>
      Create new <wen-icon-angle-down></wen-icon-angle-down>
    </button>

    <nz-dropdown-menu #createMenu="nzDropdownMenu">
      <wen-menu *ngIf="isAllowedCreation">
        <wen-menu-item [routerLink]="routerService.urlToNewSpace" i18n>
          <wen-icon-space icon></wen-icon-space>Space
        </wen-menu-item>
        <wen-menu-item [routerLink]="routerService.urlToNewProposal" *ngIf="enableCreateAwardProposal" i18n>
          <wen-icon-check-circle icon></wen-icon-check-circle>Proposal
        </wen-menu-item>
        <wen-menu-item [routerLink]="routerService.urlToNewAward" *ngIf="enableCreateAwardProposal" i18n>
          <wen-icon-award icon></wen-icon-award>Award
        </wen-menu-item>
        <wen-menu-item [routerLink]="routerService.urlToNewCollection" *ngIf="enableCreateAwardProposal" i18n>
          <wen-icon-award icon></wen-icon-award>Collection
        </wen-menu-item>
      </wen-menu>
    </nz-dropdown-menu>

    <wen-sign-in *ngIf="(isLoggedIn$ | async) === false"
      [ngClass]="isMemberProfile ? 'isMember' : ''"></wen-sign-in>
    <button nz-button nz-dropdown nzType="default" nzShape="circle" nz-tooltip nzTooltipTitle="Coming SOON"
      nzTooltipPlacement="bottom" *ngIf="isLoggedIn$ | async" [nzDropdownMenu]="notificationMenu"
      [ngClass]="isMemberProfile ? 'bg-bg-background hover:bg-bg-background' : ''"
      class="inline-flex items-center justify-center border-0 wen-header-button">
      <wen-icon-bell class="text-app-gray-text"></wen-icon-bell>
    </button>

    <button nz-button nz-dropdown nzShape="round" nzTrigger="click" nzSize="default" [nzDropdownMenu]="userMenu"
      [ngClass]="isMemberProfile ? 'bg-bg-background hover:bg-bg-background' : ''"
      class="inline-flex items-center h-16 gap-3 pl-2 font-bold border-0 wen-header-button" *ngIf="isLoggedIn$ | async">
      <nz-avatar nzIcon="user" [nzSrc]="(member$ | async)?.currentProfileImage | ipfsAvatar:filesizes.small" [nzSize]="48"
      class="mr-1"></nz-avatar>
      {{
        '@ ' + ((member$ | async)?.name || (member$ | async)?.uid || '')
      | truncate: [12]
      }}
      <wen-icon-angle-down></wen-icon-angle-down>
    </button>
  </ng-template>

  <nz-dropdown-menu #notificationMenu="nzDropdownMenu"> </nz-dropdown-menu>

  <nz-dropdown-menu #userMenu="nzDropdownMenu">
    <wen-menu>
      <wen-menu-item (click)="goToMyProfile()" i18n>
        <wen-icon-unamused icon></wen-icon-unamused>
        My Profile
      </wen-menu-item>
      <wen-sign-out></wen-sign-out>
    </wen-menu>
  </nz-dropdown-menu>
</header>

<wen-sign-in-modal></wen-sign-in-modal>
