<wen-collapse i18n-title title="Timeline" [isCollapsed]="false" class="overflow-hidden" *ngIf="(orders?.length || listedBy) && timelineType === 'nft'">
  <div *ngIf="nft?.owner && (nft?.availableFrom || nft?.auctionFrom)"
    class="relative flex items-center mt-3">
    <div class="absolute w-0.5 bg-app-gray-100 left-3 transform -translate-x-1/2 translate-y-1/2 h-24"></div>

    <div class="relative z-10 flex items-center justify-center mr-4 text-white rounded-full min-w-6 min-h-6 bg-orange">
      <wen-icon-check></wen-icon-check>
    </div>

    <div class="flex items-center justify-between w-full p-3 border lg:p-5 border-app-gray-100 rounded-large">
      <div class="flex items-center">
        <nz-avatar [nzSrc]="owner?.currentProfileImage | ipfsAvatar:filesizes.small"
          style="max-width: 40px; min-width: 40px;" [nzSize]="40"></nz-avatar>

        <div class="ml-6">
          <div class="text-xs font-medium text-gray-400">
            {{ (nft?.availableFrom || nft?.auctionFrom)?.toDate() | date: (deviceService.isDesktop$ | async) ? "medium" : "mediumDate" }}</div>
          <div class="text-base font-medium mt-0.5">
            <ng-container *ngIf="nft?.availableFrom">
              <span i18n>Listed by</span> @{{(owner?.name || owner?.uid) | truncate:[10] }}
            </ng-container>
            <ng-container *ngIf="!nft?.availableFrom && nft?.auctionFrom">
              <span i18n>Made available for auction by</span> @{{(owner?.name || owner?.uid) | truncate:[10] }}
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngFor="let t of orders | slice:0:(showAll ? (orders)?.length : collapsedEventsCount); let i = index; trackBy: trackByUid"
    class="relative flex items-center mt-3">
    <div *ngIf="i !== 0"
      class="absolute w-0.5 h-full bg-app-gray-100 left-3 transform -translate-x-1/2 -translate-y-1/2"></div>

    <div class="absolute w-0.5 bg-app-gray-100 left-3 transform -translate-x-1/2 translate-y-1/2"
      [ngClass]="i === 0 ? (!isCollapsed ? 'h-24' : 'h-36') : 'h-full'"></div>

    <div class="relative z-10 flex items-center justify-center mr-4 text-white rounded-full min-w-6 min-h-6 bg-orange">
      <wen-icon-check></wen-icon-check>
    </div>

    <div class="flex items-center justify-between w-full p-3 border lg:p-5 border-app-gray-100 rounded-large">
      <div class="flex items-center w-full">
        <nz-avatar [nzSrc]="t.newMember.currentProfileImage| ipfsBadge:filesizes.small"
          class="bg-white border-gray-400 min-w-10 min-h-10" nzShape="circle">
        </nz-avatar>

        <div class="w-full ml-6">
          <div class="text-xs font-medium text-gray-400">
            {{ t.order.createdOn?.toDate() | date: (deviceService.isDesktop$ | async) ? "medium" : "mediumDate" }}</div>
          <div class="text-base font-medium mt-0.5">

            <nz-collapse nzGhost>
              <nz-collapse-panel [nzHeader]="lineTpl" [nzActive]="false" [nzShowArrow]="false"
                (nzActiveChange)="isCollapsed = !isCollapsed">

                <ng-template #lineTpl>
                  <span i18n>Purchased by</span> @{{t.newMember.name || t.newMember.uid}}
                  <span i18n>for</span> {{formatBest(t.order.payload.amount)}}
                  <a class="inline text-sm underline text-blue-light1">{{isCollapsed ? 'hide' : 'see'}} <span i18n>details</span></a>
                </ng-template>

                <div class="overflow-y-auto max-h-24">
                  <div *ngFor="let tt of (t.transactions || [])" class="relative flex items-center my-1">
                    <div class="mr-2 text-sm font-medium text-foregrounds-secondary">{{tt.createdOn?.toDate() | date:
                      "short"}}</div>

                    <a class="absolute text-sm font-medium underline left-32 text-blue-light1" target="_new"
                      [href]="getExplorerLink(tt.payload.chainReference || tt.payload?.walletReference?.chainReference)">{{getTitle(tt)}}</a>

                    <span class="absolute text-sm font-medium text-red-500 left-56"
                      *ngIf="tt.payload.invalidPayment" i18n>Invalid</span>
                  </div>
                </div>

              </nz-collapse-panel>
            </nz-collapse>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="relative flex items-center mt-3" *ngIf="listedBy && (showAll || (orders?.length || 0) < collapsedEventsCount)">
    <div *ngIf="((orders)?.length || 0) > 0"
      class="absolute w-0.5 bg-app-gray-100 left-3 transform -translate-x-1/2 translate-y-1/2"></div>

    <div class="relative z-10 flex items-center justify-center mr-4 text-white rounded-full min-w-6 min-h-6 bg-orange">
      <wen-icon-check></wen-icon-check>
    </div>

    <div class="flex items-center justify-between w-full p-3 border lg:p-5 border-app-gray-100 rounded-large">
      <div class="flex items-center">
        <nz-avatar [nzSrc]="previewImageService.getAvatarSize(listedBy.avatarUrl)"
          class="bg-white border-gray-400 min-w-10 min-h-10" nzShape="circle">
        </nz-avatar>

        <div class="ml-6">
          <div class="text-xs font-medium text-gray-400">
            {{ nft?.createdOn?.toDate() | date: (deviceService.isDesktop$ | async) ? "medium" : "mediumDate" }}</div>
          <div class="text-base font-medium mt-0.5">
            <span i18n>Listed by space</span> {{listedBy.name || listedBy.uid}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <button nz-button nzType="primary" class="self-center block w-48 mx-auto mt-6"
      *ngIf="((orders)?.length || 0) > (listedBy ? collapsedEventsCount - 1 : collapsedEventsCount)"
      (click)="showAll = !showAll">
      <ng-container *ngIf="showAll; else showMoreBlock" i18n>Show less</ng-container>
      <ng-template #showMoreBlock i18n>Show more</ng-template>
  </button>
</wen-collapse>

<nz-card nzTitle="Timeline" class="overflow-hidden" *ngIf="badges?.length && timelineType === 'badge'">
  <div *ngFor="let t of (badges) | slice:0:(showAllBadges ? (badges)?.length : 3);
      let i = index; trackBy: trackByUid"
      class="relative flex items-center mt-3">
      <div *ngIf="i !== 0" #timelineLine
          class="absolute w-0.5 h-full bg-app-gray-100 left-3 transform -translate-x-1/2 -translate-y-1/2"></div>

      <div *ngIf="i < ((badges)?.length || 0) - 1" #timelineLine
          class="absolute w-0.5 bg-app-gray-100 left-3 transform -translate-x-1/2 translate-y-1/2"
          [ngClass]="!showAllBadges && ((badges)?.length || 0) > 3 && i === 2 ? 'h-96' : 'h-1/2'"></div>

      <div class="relative z-10 flex items-center justify-center mr-4 text-white rounded-full min-w-6 min-h-6 bg-orange">
          <wen-icon-check></wen-icon-check>
      </div>

      <div class="flex items-center justify-between w-full p-3 border lg:p-5 border-app-gray-100 rounded-large">
          <div class="flex items-center">
              <nz-avatar
                  [nzSrc]="t?.payload.image | ipfsBadge:filesizes.small"
                  class="bg-white border-gray-400 min-w-10 min-h-10"
                  nzShape="circle"
              >
              </nz-avatar>

              <div class="ml-6">
                  <div class="text-xs font-medium text-gray-400">
                      {{ t.createdOn?.toDate() | date: (deviceService.isDesktop$ | async) ? "medium" : "mediumDate" }}</div>
                  <div class="text-base font-medium mt-0.5">
                      <span i18n>Earned Badge</span> {{t.payload.name}} <span i18n>with</span> {{t.payload.xp}}XP</div>
              </div>
          </div>
      </div>
  </div>

  <button nz-button nzType="primary" class="self-center block w-48 mx-auto mt-6"
      *ngIf="((badges)?.length || 0) > 3"
      (click)="showAllBadges = !showAllBadges">        
      <ng-container *ngIf="showAllBadges; else showMoreBlock" i18n>Show less</ng-container>
      <ng-template #showMoreBlock i18n>Show more</ng-template>
  </button>
</nz-card>
