<wen-modal-drawer
    i18n-title
    title="Trade details"
    [isOpen]="isOpen"
    [content]="content"
    (wenOnClose)="close()">
</wen-modal-drawer>

<ng-template #content>
    <ng-container *ngIf="isSinglePurchase">
        <div class="flex items-center mt-8 lg:mt-6">
            <nz-avatar [nzSrc]="previewImageService.getTokenSize(token?.icon)"
              class="border-2 border-tags-border dark:border-tags-border-dark min-w-12"
              nzShape="circle"
              [nzSize]="48">
            </nz-avatar>
            <div class="ml-4 text-lg font-bold">{{ token?.name }}</div>
            <div class="ml-2 font-medium">({{ token?.symbol }})</div>
        </div>

        <div class="flex items-center justify-between w-full px-6 py-4 mt-6 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-3xl">
            <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                Traded amount</div>

            <div class="font-bold">{{ unitsService.format(tradeDetailPurchases[0].count, token?.mintingData?.network, true, false) }} {{ token?.symbol }}</div>
        </div>
        <div class="flex items-center justify-between w-full px-6 py-4 mt-2 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-3xl">
            <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                Date and Time</div>

            <div class="font-bold">{{ tradeDetailPurchases[0].createdOn?.toDate() | date: 'medium' }}</div>
        </div>
        <div class="flex items-center justify-between w-full px-6 py-4 mt-2 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-3xl">
            <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
                <ng-container i18n>Price in</ng-container> {{ unitsService.label(token?.mintingData?.network) }}</div>

            <div class="font-bold">{{ unitsService.format((tradeDetailPurchases[0].price || 0) * 1000 * 1000, token?.mintingData?.network, undefined, false) }}</div>
        </div>
        <div class="flex items-center justify-between w-full px-6 py-4 mt-2 mb-8 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-3xl">
            <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                Fullfilled</div>

            <div class="font-bold">asd</div>
        </div>
    </ng-container>

    <nz-table class="block w-full overflow-y-auto lg:min-h-0"
            [nzData]="[{}]" [nzShowPagination]="false" nzSize="small">
            <thead>
                <tr>
                    <th i18n>Date</th>
                    <th i18n>Amount</th>
                    <th i18n>State</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let item of tradeDetailPurchases; let i = index">
                    <tr *ngIf="billPaymentTransactions$[i] | async">
                        <td class="text-sm font-medium">{{ (billPaymentTransactions$[i] | async)?.createdOn?.toDate() | date: 'medium' }}</td>
                        <td class="text-sm font-medium" *ngIf="(billPaymentTransactions$[i] | async)?.payload.nativeTokens?.[0]?.amount">
                          {{ unitsService.format((billPaymentTransactions$[i] | async)?.payload.nativeTokens[0].amount, undefined, false, false) }} {{ token?.symbol }}
                        </td>
                        <td class="text-sm font-medium" *ngIf="!(billPaymentTransactions$[i] | async)?.payload.nativeTokens?.[0]?.amount">
                          {{ unitsService.format((billPaymentTransactions$[i] | async)?.payload.amount, (billPaymentTransactions$[i] | async)?.sourceNetwork) }}
                        </td>
                        <td class="text-sm font-medium">
                            <ng-container *ngIf="tradeDetailPurchases[i]?.triggeredBy === tokenTradeOrderTypes.BUY" i18n>Fullfilment</ng-container>
                            <ng-container *ngIf="tradeDetailPurchases[i]?.triggeredBy === tokenTradeOrderTypes.SELL" i18n>Seller</ng-container>
                        </td>
                        <td class="text-right">
                            <span class="text-xs font-medium" *ngIf="paymentNotProcessedOrInProgress((billPaymentTransactions$[i] | async))" i18n>{{getWalletStatus((billPaymentTransactions$[i] | async))}}</span>
                            <a class="text-xs font-medium text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" *ngIf="!paymentNotProcessedOrInProgress((billPaymentTransactions$[i] | async) || undefined)"
                                target="_blank" [href]="transactionService.getExplorerLink((billPaymentTransactions$[i] | async) || undefined)" i18n>Transaction</a>
                        </td>
                    </tr>
                    <tr *ngIf="buyerBillPaymentTransactions$[i] | async">
                        <td class="text-sm font-medium">{{ (buyerBillPaymentTransactions$[i] | async)?.createdOn?.toDate() | date: 'medium' }}</td>
                        <td class="text-sm font-medium" *ngIf="(buyerBillPaymentTransactions$[i] | async)?.payload.nativeTokens?.[0]?.amount">
                          {{ unitsService.format((buyerBillPaymentTransactions$[i] | async)?.payload.nativeTokens[0].amount, undefined, false, false) }} {{ token?.symbol }}
                        </td>
                        <td class="text-sm font-medium" *ngIf="!(buyerBillPaymentTransactions$[i] | async)?.payload.nativeTokens?.[0]?.amount">
                          {{ unitsService.format((buyerBillPaymentTransactions$[i] | async)?.payload.amount, (buyerBillPaymentTransactions$[i] | async)?.sourceNetwork) }}
                        </td>
                        <td class="text-sm font-medium">
                            <ng-container *ngIf="tradeDetailPurchases[i]?.triggeredBy === tokenTradeOrderTypes.BUY" i18n>Seller</ng-container>
                            <ng-container *ngIf="tradeDetailPurchases[i]?.triggeredBy === tokenTradeOrderTypes.SELL" i18n>Fullfilment</ng-container>
                        </td>
                        <td class="text-right">
                            <span class="text-xs font-medium" *ngIf="paymentNotProcessedOrInProgress((buyerBillPaymentTransactions$[i] | async))" i18n>{{getWalletStatus((buyerBillPaymentTransactions$[i] | async))}}</span>
                            <a class="text-xs font-medium text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" *ngIf="!paymentNotProcessedOrInProgress((buyerBillPaymentTransactions$[i] | async) || undefined)"
                                target="_blank" [href]="transactionService.getExplorerLink((buyerBillPaymentTransactions$[i] | async) || undefined)" i18n>Transaction</a>
                        </td>
                    </tr>
                    <tr *ngFor="let item of royaltyBillPaymentsTransactions$[i] | async">
                        <td class="text-sm font-medium">{{ item?.createdOn?.toDate() | date: 'medium' }}</td>
                        <td class="text-sm font-medium">{{ unitsService.format(item?.payload.amount, item?.sourceNetwork) }}</td>
                        <td class="text-sm font-medium" >
                            <ng-container i18n>Fee</ng-container> <ng-container *ngIf="getFee(item)"> {{ getFee(item) | percent : '1.2-2' }}</ng-container>
                        </td>
                        <td class="text-right">
                            <span class="text-xs font-medium" *ngIf="paymentNotProcessedOrInProgress(item)" i18n>{{getWalletStatus(item)}}</span>
                            <a class="text-xs font-medium text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" *ngIf="!paymentNotProcessedOrInProgress(item || undefined)"
                                target="_blank" [href]="transactionService.getExplorerLink(item || undefined)" i18n>Transaction</a>
                        </td>
                    </tr>
                    <tr *ngIf="sellerCreditTransactions$[i] | async">
                      <td class="text-sm font-medium">{{ (sellerCreditTransactions$[i] | async)?.createdOn?.toDate() | date: 'medium' }}</td>
                      <td class="text-sm font-medium">{{ unitsService.format((sellerCreditTransactions$[i] | async)?.payload.amount, (sellerCreditTransactions$[i] | async)?.sourceNetwork) }}</td>
                      <td class="text-sm font-medium" i18n>
                          Seller's Credit
                      </td>
                      <td class="text-right">
                          <span class="text-xs font-medium" *ngIf="paymentNotProcessedOrInProgress((sellerCreditTransactions$[i] | async))" i18n>{{getWalletStatus((sellerCreditTransactions$[i] | async))}}</span>
                          <a class="text-xs font-medium text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" *ngIf="!paymentNotProcessedOrInProgress((sellerCreditTransactions$[i] | async) || undefined)"
                              target="_blank" [href]="transactionService.getExplorerLink((sellerCreditTransactions$[i] | async) || undefined)" i18n>Transaction</a>
                      </td>
                    </tr>
                    <tr *ngIf="buyerCreditTransactions$[i] | async">
                      <td class="text-sm font-medium">{{ (buyerCreditTransactions$[i] | async)?.createdOn?.toDate() | date: 'medium' }}</td>
                      <td class="text-sm font-medium">{{ unitsService.format((buyerCreditTransactions$[i] | async)?.payload.amount, (buyerCreditTransactions$[i] | async)?.sourceNetwork) }}</td>
                      <td class="text-sm font-medium" i18n>
                          Buyer's Credit
                      </td>
                      <td class="text-right">
                          <span class="text-xs font-medium" *ngIf="paymentNotProcessedOrInProgress((buyerCreditTransactions$[i] | async))" i18n>{{getWalletStatus((buyerCreditTransactions$[i] | async))}}</span>
                          <a class="text-xs font-medium text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" *ngIf="!paymentNotProcessedOrInProgress((buyerCreditTransactions$[i] | async) || undefined)"
                              target="_blank" [href]="transactionService.getExplorerLink((buyerCreditTransactions$[i] | async) || undefined)" i18n>Transaction</a>
                      </td>
                  </tr>
                </ng-container>
            </tbody>
        </nz-table>
</ng-template>
