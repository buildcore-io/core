<wen-modal-drawer
    i18n-title
    title="Mint token on network"
    [isOpen]="isOpen"
    [content]="content"
    (wenOnClose)="close()">
</wen-modal-drawer>

<ng-template #content>
    <div class="w-full pb-4 overflow-x-auto lg:pb-0">
        <div class="relative flex items-start justify-between mt-10 min-w-120">
            <div class="flex flex-col items-center ml-6">
                <div #selectCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold rounded-full text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark"
                    [ngClass]="{
                        'bg-accent-primary dark:bg-accent-primary-dark': currentStep === stepType.SELECT,
                        'bg-accent-secondary dark:bg-accent-secondary-dark': currentStep === stepType.TRANSACTION ||
                            currentStep === stepType.WAIT || currentStep === stepType.CONFIRMED
                    }">
                    1
                </div>
                <div class="mt-1 text-sm font-bold text-center" i18n>Select Network</div>
            </div>

            <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark h-0.5 absolute top-3"
                [ngStyle]="{
                    'left' : (selectCheckbox.offsetLeft + selectCheckbox.offsetWidth + 8) + 'px',
                    'width' : (transactionCheckbox.offsetLeft - selectCheckbox.offsetLeft - selectCheckbox.offsetWidth - 16) + 'px'
                }" [ngClass]="{ 'opacity-50': currentStep === stepType.SELECT }"></div>

            <div class="flex flex-col items-center">
                <div #transactionCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold rounded-full"
                    [ngClass]="{
                        'text-foregrounds-secondary dark:text-foregrounds-secondary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark': currentStep === stepType.SELECT,
                        'bg-accent-primary dark:bg-accent-primary-dark text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark': currentStep === stepType.TRANSACTION,
                        'bg-accent-secondary dark:bg-accent-secondary-dark text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark': currentStep === stepType.WAIT || currentStep === stepType.CONFIRMED
                    }">
                    2
                </div>
                <div class="mt-1 text-sm font-bold text-center" i18n
                    [ngClass]="{
                        'opacity-50': currentStep === stepType.SELECT
                    }">Make transaction</div>
            </div>

            <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark h-0.5 absolute top-3"
                [ngStyle]="{
                    'left' : (transactionCheckbox.offsetLeft + transactionCheckbox.offsetWidth + 8) + 'px',
                    'width' : (waitCheckbox.offsetLeft - transactionCheckbox.offsetLeft - transactionCheckbox.offsetWidth - 16) + 'px'
                }" [ngClass]="{ 'opacity-50': currentStep === stepType.SELECT || currentStep === stepType.TRANSACTION }"></div>

            <div class="flex flex-col items-center">
                <div #waitCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold rounded-full"
                    [ngClass]="{
                        'text-foregrounds-secondary dark:text-foregrounds-secondary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark':
                            currentStep === stepType.SELECT || currentStep === stepType.TRANSACTION,
                        'bg-accent-primary dark:bg-accent-primary-dark text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark': currentStep === stepType.WAIT,
                        'bg-accent-secondary dark:bg-accent-secondary-dark text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark': currentStep === stepType.CONFIRMED
                    }">
                    3
                </div>
                <div class="mt-1 text-sm font-bold text-center" i18n
                    [ngClass]="{
                        'opacity-50': currentStep === stepType.SELECT || currentStep === stepType.TRANSACTION
                    }">Wait for confirmation</div>
            </div>

            <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark opacity-50 h-0.5 absolute top-3"
                [ngStyle]="{
                    'left' : (waitCheckbox.offsetLeft + waitCheckbox.offsetWidth + 8) + 'px',
                    'width' : (confirmedCheckbox.offsetLeft - waitCheckbox.offsetLeft - waitCheckbox.offsetWidth - 16) + 'px'
                }" [ngClass]="{ 'opacity-50': currentStep === stepType.SELECT ||
                    currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT}"></div>

            <div class="flex flex-col items-center mr-6">
                <div #confirmedCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold rounded-full text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
                    [ngClass]="{
                        'text-foregrounds-secondary dark:text-foregrounds-secondary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark': currentStep === stepType.SELECT ||
                            currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT,
                        'bg-alerts-success dark:bg-alerts-success-dark text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark': currentStep === stepType.CONFIRMED
                    }">
                    <wen-icon-check></wen-icon-check>
                </div>
                <div class="mt-1 text-sm font-bold text-center" i18n
                    [ngClass]="{
                        'opacity-50': currentStep === stepType.SELECT ||
                            currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT
                    }">Confirmed</div>
            </div>
        </div>
    </div>

    <div [ngSwitch]="true" class="absolute bottom-0 w-full top-56 lg:static">
        <ng-container *ngSwitchCase="currentStep === stepType.SELECT">
            <ng-container *ngTemplateOutlet="selectTemplate"></ng-container>
        </ng-container>

        <ng-container *ngSwitchCase="currentStep === stepType.TRANSACTION">
            <ng-container *ngTemplateOutlet="transactionTemplate"></ng-container>
        </ng-container>

        <ng-container *ngSwitchCase="currentStep === stepType.WAIT || currentStep === stepType.CONFIRMED">
            <ng-container *ngTemplateOutlet="waitTemplate"></ng-container>
        </ng-container>
    </div>

    <ng-template #selectTemplate>
        <div class="flex flex-col justify-between h-full mt-10 lg:items-center lg:justify-start">
            <div class="flex w-full p-4 font-medium bg-tags-commencing dark:bg-tags-commencing-dark rounded-xl">
                <wen-icon-info-circle class="text-icons-primary dark:text-icons-primary-dark"></wen-icon-info-circle>
                <div class="ml-2.5" i18n>
                    Once minted all owners will have the option to migrate their tokens to the selected network.
                </div>
            </div>

            <div class="flex w-full p-4 mt-3 font-medium bg-tags-commencing dark:bg-tags-commencing-dark rounded-xl">
                <wen-icon-info-circle class="text-icons-primary dark:text-icons-primary-dark"></wen-icon-info-circle>
                <div class="ml-2.5" i18n>
                    Note that all undistributed tokens will be deposited to your member profile.
                </div>
            </div>

            <div class="flex items-center w-full mt-10">
                <nz-avatar [nzSrc]="previewImageService.getAvatarSize(token?.icon)"
                  class="border-2 border-tags-border dark:border-tags-border-dark min-w-12"
                  nzShape="circle"
                  [nzSize]="48">
                </nz-avatar>
                <div class="ml-4 text-lg font-bold">{{ token?.name }}</div>
                <div class="ml-3 font-medium">({{ token?.symbol }})</div>
            </div>

            <div class="flex items-center justify-between w-full px-5 py-4 mt-6 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>Tokens to migrate</div>
                <div class="font-bold">{{ (formatTokenBest(token?.totalSupply) | number : '1.0-2') }} {{ token?.symbol }}</div>
            </div>

            <div class="flex items-center justify-between w-full px-5 py-4 mt-3 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>Locked public tokens</div>
                <div class="font-bold">{{ (formatTokenBest(lockedPublicTokens) | number : '1.0-2') }} {{ token?.symbol }}</div>
            </div>

            <div class="w-full mt-8 text-xs font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                Select Network
            </div>

            <div class="flex flex-wrap items-center w-full">
                <div class="py-3 network" [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.SMR }"
                    (click)="selectedNetwork = networkTypes.SMR">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="text-sm font-semibold" i18n>Shimmer</div>
                </div>
                <div *ngIf="!environment.production" class="py-3 network"
                    [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.RMS }"
                    (click)="selectedNetwork = networkTypes.RMS">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="text-sm font-semibold" i18n>Shimmer TEST</div>
                </div>
                <div class="py-2 network" [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.IOTA }"
                    (click)="selectedNetwork = networkTypes.IOTA">
                        <div class="text-lg font-semibold" i18n>IOTA</div>
                        <div class="w-px h-5 bg-[#66DDCA] ml-1.5 mr-1"></div>
                        <div class="font-medium -translate-y-1 text-xxs text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
                            i18n>Mainnet</div>
                </div>
                <div *ngIf="!environment.production" class="py-2 network"
                    [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.ATOI }"
                    (click)="selectedNetwork = networkTypes.ATOI">
                        <div class="text-lg font-semibold" i18n>IOTA</div>
                        <div class="w-px h-5 bg-[#66DDCA] ml-1.5 mr-1"></div>
                        <div class="font-medium -translate-y-1 text-xxs text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
                            i18n>TEST</div>
                </div>

                <!-- <div class="py-2 network" [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.SMR }"
                    (click)="selectedNetwork = networkTypes.SMR">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="font-semibold">
                            <div class="text-sm" i18n>Shimmer</div>
                            <div class="text-foregrounds-secondary dark:text-foregrounds-secondary-dark text-xxs leading-[0.5rem]">EVM</div>
                        </div>
                </div>

                <div class="py-2 network" [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.IOTA }"
                    (click)="selectedNetwork = networkTypes.IOTA">
                        <div class="text-lg font-semibold" i18n>IOTA</div>
                        <div class="w-px h-5 bg-[#66DDCA] ml-1.5 mr-1"></div>
                        <div class="font-medium -translate-y-1 text-xxs text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
                            i18n>Mainnet</div>
                </div> -->

                <!-- <div class="network py-2.5" [ngClass]="{ 'network__selected': selectedNetwork === networkTypes.SMR }"
                    (click)="selectedNetwork = networkTypes.SMR">
                        <wen-icon-assembly [size]="20"></wen-icon-assembly>
                        <div class="font-semibold" i18n>assembly</div>
                </div> -->
            </div>

            <wen-terms-and-conditions
                class="w-full mt-8"
                [isChecked]="agreeTermsConditions"
                documentLink="https://docs.google.com/document/d/1ng67fXTdINhmgkLpnbS_SkiDlZSsDAqrd13cbwXQCcQ"
                (wenOnCheckChange)="agreeTermsConditions = $event">
            </wen-terms-and-conditions>

            <button nz-button nzType="primary" nzSize="large" class="w-full mt-6 lg:w-auto"
                [disabled]="!agreeTermsConditions || selectedNetwork === undefined" (click)="proceedWithMint()" i18n>
                    Confirm & Start minting
            </button>

            <div class="w-3/5 mt-6 text-sm font-medium text-center text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                Once you agree with the terms, the  generated address will remain active during the whole sale.
            </div>
        </div>
    </ng-template>

    <ng-template #transactionTemplate>
        <div class="flex flex-col items-center justify-between h-full mt-10 lg:justify-start">

            <div class="flex items-center w-full">
                <nz-avatar [nzSrc]="previewImageService.getAvatarSize(token?.icon)"
                  class="border-2 border-tags-border dark:border-tags-border-dark min-w-12"
                  nzShape="circle"
                  [nzSize]="48">
                </nz-avatar>
                <div class="ml-4 text-lg font-bold">{{ token?.name }}</div>
                <div class="ml-3 font-medium">({{ token?.symbol }})</div>
            </div>

            <div class="flex items-center justify-between w-full p-4 mt-6 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                    Tokens to migrate</div>

                <div class="font-bold">{{ (formatTokenBest(token?.totalSupply) | number : '1.0-2') }} {{ token?.symbol }}</div>
            </div>

            <div class="flex items-center justify-between w-full p-4 mt-3 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                    Locked public tokens</div>

                <div class="font-bold">{{ (formatTokenBest(lockedPublicTokens) | number : '1.0-2') }} {{ token?.symbol }}</div>
            </div>

            <div class="flex items-center justify-between w-full p-4 mt-3 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                    Selected Network</div>

                <div class="flex items-center">
                    <ng-container *ngIf="selectedNetwork === networkTypes.SMR">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="ml-1 text-sm font-semibold" i18n>Shimmer</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.RMS">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="ml-1 text-sm font-semibold" i18n>Shimmer TEST</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.IOTA">
                        <wen-icon-iota [size]="20"></wen-icon-iota>
                        <div class="ml-1 text-sm font-semibold" i18n>IOTA</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.ATOI">
                        <wen-icon-iota [size]="20"></wen-icon-iota>
                        <div class="ml-1 text-sm font-semibold" i18n>IOTA TEST</div>
                    </ng-container>
                </div>
            </div>

            <nz-alert class="mt-2" nzType="warning" nzShowIcon *ngIf="!isExpired((transaction$ | async)) && invalidPayment" nzMessage="We received invalid amount. Try again."></nz-alert>

            <div class="w-full px-4 py-3 mt-8 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-2xl" *ngIf="!isExpired((transaction$ | async))">
                <div class="text-xs font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
                    <span i18n>Send</span> {{formatBest(targetAmount) }} <span i18n> to following address:</span>
                </div>

                <div class="flex flex-wrap items-center justify-between mt-2 break-all">
                    <div class="text-base font-medium break-words">
                        {{ targetAddress }}
                    </div>

                    <button nz-button nzBlock nzSize="small" nzType="primary" class="w-16 mt-4 lg:mt-0" (click)="copyAddress()">
                        <ng-container *ngIf="isCopied; else isNotCopied" i18n>Copied</ng-container>
                        <ng-template #isNotCopied i18n>Copy</ng-template>
                    </button>
                </div>
            </div>

            <div class="mt-10 text-xs font-medium text-center text-foregrounds-secondary dark:text-foregrounds-secondary-dark lg:w-4/5" i18n>
                Do not send funds from an exchange, always use wallets you fully control.
            </div>

            <wen-wallet-deeplink
                *ngIf="!isExpired((transaction$ | async))"
                class="w-full mt-6 lg:w-auto"
                [targetAddress]="targetAddress"
                [targetAmount]="((targetAmount || 0) / 1000 / 1000)?.toString()">
            </wen-wallet-deeplink>
        </div>
    </ng-template>

    <ng-template #waitTemplate>
        <div class="flex flex-col items-center justify-between h-full lg:justify-start">

            <div class="flex items-center w-full mt-10">
                <nz-avatar [nzSrc]="previewImageService.getAvatarSize(token?.icon)"
                  class="border-2 border-tags-border dark:border-tags-border-dark min-w-12"
                  nzShape="circle"
                  [nzSize]="48">
                </nz-avatar>
                <div class="ml-4 text-lg font-bold">{{ token?.name }}</div>
                <div class="ml-3 font-medium">({{ token?.symbol }})</div>
            </div>

            <div class="flex items-center justify-between w-full p-4 mt-6 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-xl">
                <div class="font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
                    Selected Network</div>

                <div class="flex items-center">
                    <ng-container *ngIf="selectedNetwork === networkTypes.SMR">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="ml-1 text-sm font-semibold" i18n>Shimmer</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.RMS">
                        <wen-icon-shimmer [size]="20"></wen-icon-shimmer>
                        <div class="ml-1 text-sm font-semibold" i18n>Shimmer TEST</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.IOTA">
                        <wen-icon-iota [size]="20"></wen-icon-iota>
                        <div class="ml-1 text-sm font-semibold" i18n>IOTA</div>
                    </ng-container>
                    <ng-container *ngIf="selectedNetwork === networkTypes.ATOI">
                        <wen-icon-iota [size]="20"></wen-icon-iota>
                        <div class="ml-1 text-sm font-semibold" i18n>IOTA TEST</div>
                    </ng-container>
                </div>
            </div>

            <div class="w-full mt-10 border border-inputs-border dark:border-inputs-border-dark rounded-2xl">
                <div class="px-5 pt-3 pb-2 text-sm font-bold border-b" i18n>
                    Transaction history
                </div>

                <div class="h-32 px-5 pt-4 pb-2 mr-2 overflow-y-scroll">
                    <div *ngFor="let t of history; let first=first"
                        class="relative flex items-center my-1">
                            <div class="mr-2 text-sm font-medium text-foregrounds-secondary">{{ t.date | Time }}</div>
                            <a class="absolute text-sm font-medium underline left-16 text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" target="_blank" *ngIf="t.link" [href]="getExplorerLink(t.link)"
                          >{{ t.label }}</a>
                          <div class="absolute text-sm font-medium left-16" *ngIf="!t.link">{{ t.label }}</div>
                    </div>
                </div>
            </div>

            <ng-container *ngIf="currentStep === stepType.CONFIRMED">
                <div class="flex items-center mt-10 lg:w-3/5">
                    <div class="flex items-center justify-center w-10 h-10 rounded-full min-w-10 min-h-10 bg-alerts-success dark:bg-alerts-success-dark">
                        <wen-icon-check class="text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark"></wen-icon-check>
                    </div>
                    <div class="ml-3.5 text-lg font-medium" i18n>
                        Transaction complete. Congratulations.</div>
                </div>

                <button nz-button nzType="primary" nzSize="large" class="mt-10" (click)="close()" i18n>
                    Finish Mint
                </button>
            </ng-container>
        </div>
    </ng-template>
</ng-template>
