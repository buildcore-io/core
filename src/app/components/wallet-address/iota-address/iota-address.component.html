<div class="w-full pb-4 overflow-x-auto lg:pb-0">
    <div class="relative flex items-start justify-between mt-10 min-w-120">
        <div class="flex flex-col items-center ml-6">
            <div #generateCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold text-white rounded-full"
                [ngClass]="{
                    'bg-accent-primary dark:bg-accent-primary-dark': currentStep === stepType.GENERATE,
                    'bg-accent-secondary dark:bg-accent-secondary-dark': currentStep === stepType.TRANSACTION ||
                        currentStep === stepType.WAIT || currentStep === stepType.CONFIRMED
                }">
                1
            </div>
            <div class="mt-1 text-sm font-bold text-center" i18n>Generate address</div>
        </div>

        <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark h-0.5 absolute top-3"
            [ngStyle]="{
                'left' : (generateCheckbox.offsetLeft + generateCheckbox.offsetWidth + 8) + 'px',
                'width' : (transactionCheckbox.offsetLeft - generateCheckbox.offsetLeft - generateCheckbox.offsetWidth - 16) + 'px'
            }" [ngClass]="{ 'opacity-50': currentStep === stepType.GENERATE }"></div>

        <div class="flex flex-col items-center">
            <div #transactionCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold text-white rounded-full"
                [ngClass]="{
                    'text-foregrounds-primary dark:text-foregrounds-primary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark': currentStep === stepType.GENERATE,
                    'bg-accent-primary dark:bg-accent-primary-dark': currentStep === stepType.TRANSACTION,
                    'bg-accent-secondary dark:bg-accent-secondary-dark': currentStep === stepType.WAIT || currentStep === stepType.CONFIRMED
                }">
                2
            </div>
            <div class="mt-1 text-sm font-bold text-center" i18n
                [ngClass]="{
                    'opacity-50': currentStep === stepType.GENERATE
                }">Make transaction</div>
        </div>

        <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark h-0.5 absolute top-3"
            [ngStyle]="{
                'left' : (transactionCheckbox.offsetLeft + transactionCheckbox.offsetWidth + 8) + 'px',
                'width' : (waitCheckbox.offsetLeft - transactionCheckbox.offsetLeft - transactionCheckbox.offsetWidth - 16) + 'px'
            }" [ngClass]="{ 'opacity-50': currentStep === stepType.GENERATE || currentStep === stepType.TRANSACTION }"></div>

        <div class="flex flex-col items-center">
            <div #waitCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold text-white rounded-full"
                [ngClass]="{
                    'text-foregrounds-primary dark:text-foregrounds-primary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark':
                        currentStep === stepType.GENERATE || currentStep === stepType.TRANSACTION,
                    'bg-accent-primary dark:bg-accent-primary-dark': currentStep === stepType.WAIT,
                    'bg-accent-secondary dark:bg-accent-secondary-dark': currentStep === stepType.CONFIRMED
                }">
                3
            </div>
            <div class="mt-1 text-sm font-bold text-center" i18n
                [ngClass]="{
                    'opacity-50': currentStep === stepType.GENERATE || currentStep === stepType.TRANSACTION
                }">Wait for confirmation</div>
        </div>

        <div class="bg-foregrounds-tertiary dark:bg-foregrounds-tertiary-dark opacity-50 h-0.5 absolute top-3"
            [ngStyle]="{
                'left' : (waitCheckbox.offsetLeft + waitCheckbox.offsetWidth + 8) + 'px',
                'width' : (confirmedCheckbox.offsetLeft - waitCheckbox.offsetLeft - waitCheckbox.offsetWidth - 16) + 'px'
            }" [ngClass]="{ 'opacity-50': currentStep === stepType.GENERATE ||
                currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT}"></div>

        <div class="flex flex-col items-center mr-6">
            <div #confirmedCheckbox class="flex items-center justify-center w-6 h-6 text-xs font-bold text-white rounded-full"
                [ngClass]="{
                    'text-foregrounds-primary dark:text-foregrounds-primary-dark opacity-50 border border-inputs-border dark:border-inputs-border-dark': currentStep === stepType.GENERATE ||
                        currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT,
                    'bg-alerts-success dark:bg-alerts-success-dark': currentStep === stepType.CONFIRMED
                }">
                <wen-icon-check></wen-icon-check>
            </div>
            <div class="mt-1 text-sm font-bold text-center" i18n
                [ngClass]="{
                    'opacity-50': currentStep === stepType.GENERATE ||
                        currentStep === stepType.TRANSACTION || currentStep === stepType.WAIT
                }">Confirmed</div>
        </div>
    </div>
</div>

<div [ngSwitch]="currentStep" class="absolute bottom-0 w-full top-56 lg:static">
    <ng-container *ngSwitchCase="stepType.GENERATE">
        <ng-container *ngTemplateOutlet="generateTemplate"></ng-container>
    </ng-container>

    <ng-container *ngSwitchCase="stepType.TRANSACTION">
        <ng-container *ngTemplateOutlet="transactionTemplate"></ng-container>
    </ng-container>

    <ng-container *ngSwitchCase="stepType.WAIT">
        <ng-container *ngTemplateOutlet="waitTemplate"></ng-container>
    </ng-container>

    <ng-container *ngSwitchCase="stepType.CONFIRMED">
        <ng-container *ngTemplateOutlet="confirmedTemplate"></ng-container>
    </ng-container>
</div>

<ng-template #generateTemplate>
    <div class="flex flex-col items-center justify-between h-full lg:justify-start">
        <div class="mx-4 my-auto text-lg font-medium lg:mt-24 text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
            <span i18n>You will be asked to send funds to the new IOTA address for the verification process. The address you send funds from will be linked to your </span>
            <ng-container *ngIf="isSpaceVerification(); else isNotSpaceVerification" i18n>space</ng-container>
            <ng-template #isNotSpaceVerification i18n>profile</ng-template>
            <span i18n> for future transactions.</span>
        </div>

        <button nz-button nzType="primary" nzSize="large" class="lg:mt-24" i18n (click)="initVerification()">
            Generate new address
        </button>
    </div>
</ng-template>

<ng-template #transactionTemplate>
    <div class="flex flex-col items-center justify-between h-full lg:justify-start">
        <div class="max-w-md mt-10 text-lg font-medium text-center text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
            <span *ngIf="!isExpired((transaction$ | async))">
              <span i18n>Send a small </span>{{formatBest(targetAmount) }}
              <span i18n>amount to validate your address. This expires in </span>{{(expiryTicker$ | async) | countdownTime}}.
            </span>
            <span *ngIf="isExpired((transaction$ | async))" i18n>Expired.</span>
        </div>

        <nz-alert class="mt-2" nzType="warning" nzShowIcon *ngIf="!isExpired((transaction$ | async)) && invalidPayment" nzMessage="We received invalid amount. Try again."></nz-alert>

        <div class="w-full px-4 py-3 mt-14 lg:mt-4 bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark rounded-2xl" *ngIf="!isExpired((transaction$ | async))">
            <div class="text-xs font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark">
              <span i18n>Send</span> {{formatBest(targetAmount) }} <span i18n> to following address (please restake after!):</span>
            </div>

            <div class="flex flex-wrap items-center justify-between mt-2 break-all">
                <div class="text-base font-medium break-words">
                  {{ targetAddress }}
                </div>

                <button nz-button nzBlock nzSize="small" nzType="primary" class="w-16 mt-4 lg:mt-0" (click)="copyAddress()">
                    <ng-container *ngIf="isCopied; else isNotCopied" i18n>Copied</ng-container>
                    <ng-template #isNotCopied i18n>Copy</ng-template>
                </button>
            </div>
        </div>


        <wen-wallet-deeplink
            *ngIf="!isExpired((transaction$ | async))"
            class="mt-10"
            [targetAddress]="targetAddress"
            [targetAmount]="((targetAmount || 0) / 1000 / 1000)?.toString()">
        </wen-wallet-deeplink>
    </div>
</ng-template>

<ng-template #waitTemplate>
    <div class="flex flex-col items-center justify-between h-full lg:justify-start">

        <div class="mt-16 mb-8 text-lg font-medium text-center text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>
            Wait for transaction to be validated. We will send back your transaction once completed
        </div>

        <div class="w-full border border-inputs-border dark:border-inputs-border-dark rounded-2xl">
            <div class="px-5 pt-3 pb-2 text-sm font-bold border-b" i18n>
                Transaction history
            </div>

            <div class="h-32 px-5 pt-4 pb-2 mr-2 overflow-y-scroll">
                <div *ngFor="let t of history; let first=first"
                    class="relative flex items-center my-1">
                        <div class="mr-2 text-sm font-medium text-foregrounds-secondary">{{ t.date | Time }}</div>
                        <a class="absolute text-sm font-medium underline left-16 text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" target="_blank" *ngIf="t.link" [href]="getExplorerLink(t.link)"
                      >{{ t.label }}</a>
                      <div class="absolute text-sm font-medium left-16" *ngIf="!t.link">{{ t.label }}</div>
                </div>
            </div>
        </div>

        <button nz-button nzSize="large" nzType="default" class="flex items-center mt-10 border-inputs-border dark:border-inputs-border-dark">
            <wen-icon-refresh class="mr-3 text-foregrounds-secondary dark:text-foregrounds-secondary-dark animate-spin" ></wen-icon-refresh>
            <div i18n>
                Validating address...
            </div>
        </button>
    </div>
</ng-template>

<ng-template #confirmedTemplate>
    <div class="flex flex-col items-center justify-between h-full lg:justify-start">
        <div class="w-full border lg:mt-8 border-inputs-border dark:border-inputs-border-dark rounded-2xl">
          <div class="px-5 pt-3 pb-2 text-sm font-bold border-b" i18n>
              Transaction history
          </div>

          <div class="h-auto px-5 pt-4 pb-2">
              <div *ngFor="let t of history; let first=first"
                  class="relative flex items-center my-1">
                      <div class="mr-2 text-sm font-medium text-foregrounds-secondary">{{ t.date | Time }}</div>
                      <a class="absolute text-sm font-medium underline left-16 text-buttons-primary-enabled dark:text-buttons-primary-enabled-dark" target="_blank" *ngIf="t.link" [href]="getExplorerLink(t.link)"
                    >{{ t.label }}</a>
                    <div class="absolute text-sm font-medium left-16" *ngIf="!t.link">{{ t.label }}</div>
              </div>
          </div>
        </div>
        <div class="flex items-center my-auto lg:mt-16">
            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-alerts-success dark:bg-alerts-success-dark">
                <wen-icon-check class="text-foregrounds-on-primary dark:text-foregrounds-on-primary-dark"></wen-icon-check>
            </div>
            <div class="ml-4 text-lg font-medium text-foregrounds-secondary dark:text-foregrounds-secondary-dark" i18n>Now you can deal with NFTs and participate in token trading.</div>
        </div>

        <button nz-button nzType="primary" nzSize="large" class="mt-24" i18n (click)="close()">
            Finish Verification
        </button>
    </div>
</ng-template>
