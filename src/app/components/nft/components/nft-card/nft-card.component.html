<article class="bg-white rounded-2xl wen-card"
    [ngClass]="fullWidth ? 'w-full' : 'w-40 lg:w-60 h-72 lg:h-99'">
    <a class="flex flex-col h-full text-current hover:text-current" [routerLink]="['/', this.path, nft?.uid]">
        <div class="relative w-full h-40 overflow-hidden lg:h-60 rounded-2xl">
            <img
                *ngIf="mediaType === 'image'"
                i18n-alt
                (error)="onImgErrorWeShowPlaceHolderVideo($event)"
                alt="NFT image"
                [src]="previewImageService.getNftSize(nft?.media) || '/assets/mocks/no_banner.jpg'"
                class="object-cover w-full h-full"
            />

            <video *ngIf="mediaType === 'video'"
            preload="metadata" controls class="object-cover w-full h-full">
              <source [src]="nft?.media + '#t=0.001'" type="video/mp4">
              Your browser does not support HTML video.
            </video>

            <div *ngIf="!fullWidth && collection?.approved && (isAvailableForSale() || nft?.placeholderNft)"
                class="absolute top-4 left-4 z-10 rounded-lg bg-white
                    flex items-center justify-center px-3 py-1.5 text-sm font-medium"
                [ngClass]="getBadgeProperties().className">
                    {{ getBadgeProperties().label }}
            </div>
        </div>

        <div class="relative flex flex-col flex-grow w-full px-4 py-3 lg:py-4">
            <h3 class="mb-1 text-base font-bold truncate lg:text-lg">{{ nft?.name || nft?.uid }}</h3>

            <div class="mt-1 mb-3 text-sm font-medium break-all line-clamp-2">
                {{ collection?.name || '' }}
            </div>

            <ng-container *ngIf="!nft?.owner; else ownerBlock">
                <div class="flex items-center mt-auto" *ngIf="(deviceService.isDesktop$ | async)">
                    <!-- <wen-icon-dollar class="mr-1 text-app-gray-400"></wen-icon-dollar> -->
                    <!-- <div class="text-xs font-medium">{{formatBest(applyDiscount(nft?.price))}}</div> -->
                    <div class="flex-grow w-0">
                      <div class="font-medium text-xxs text-foregrounds-secondary" i18n>Price</div>
                      <div class="text-sm font-medium truncate">
                        {{formatBest(applyDiscount(nft?.price))}}
                      </div>
                  </div>

                    <span class="ml-auto" nz-tooltip i18n-nzTooltipTitle [nzTooltipTitle]="(!collection?.approved || !isAvailableForSale()) ? 'Not Available for Sale.' : undefined">
                      <button nz-button nzType="primary" [disabled]="!collection?.approved || !isAvailableForSale()"
                          (click)="onBuy($event)" i18n>Buy now</button>
                    </span>
                </div>

                <span class="w-4/5 mt-2 ml-auto" nz-tooltip i18n-nzTooltipTitle [nzTooltipTitle]="(!collection?.approved || !isAvailableForSale()) ? 'Not Available for Sale.' : undefined">
                  <button *ngIf="(deviceService.isMobile$ | async)" nz-button nzType="primary" nzSize="small" [disabled]="!collection?.approved || !isAvailableForSale()"
                      (click)="onBuy($event)" i18n>Buy now</button>
                </span>
            </ng-container>

            <ng-template #ownerBlock>
                <a [routerLink]="['/member', (owner$ | async)?.uid]" class="flex items-center mt-auto" (click)="$event.stopPropagation()">
                    <nz-avatar [nzSrc]="(owner$ | async)?.currentProfileImage | ipfsAvatar:filesizes.small"
                        class="border-2 border-app-gray-100 bg-bg-background min-w-10"
                        style="max-width: 32px; min-width: 32px;" [nzSize]="32">
                    </nz-avatar>
                    <div class="flex-grow w-0 ml-2">
                        <div class="font-medium text-xxs text-foregrounds-secondary" i18n>Owned by</div>
                        <div class="text-sm font-medium truncate">
                            @{{((owner$ | async)?.name || (owner$ | async)?.uid) }}
                        </div>
                    </div>
                </a>
            </ng-template>
        </div>
    </a>
</article>

<wen-nft-checkout *ngIf="isCheckoutOpen" [isOpen]="isCheckoutOpen" [nft]="nft" [collection]="collection" (wenOnClose)="isCheckoutOpen = false"></wen-nft-checkout>
