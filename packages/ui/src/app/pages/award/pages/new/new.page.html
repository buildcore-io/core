<wen-content [showBackButton]="(deviceService.isDesktop$ | async) || false">
  <h1 class="mt-7" i18n>New Award</h1>

  <form nz-form nzLayout="vertical">
    <div class="py-4" nz-row [nzGutter]="24">
      <div
        class="space-y-4"
        nz-col
        nzFlex="auto"
        [ngStyle]="{
          'max-width': (deviceService.isDesktop$ | async) ? 'calc(100% - 450px)' : '100%'
        }"
      >
        <nz-card [nzBordered]="false" i18n-nzErrorTip nzErrorTip="Title is required.">
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Award info"
            i18n-nzDescription
            nzDescription="Title and description will be included on the Award. End date determines the duration of the Award."
          >
          </nz-card-meta>
          <nz-form-item class="mt-4 floating-title" [ngClass]="nameControl.value ? 'value' : ''">
            <nz-form-label i18n>Title</nz-form-label>
            <nz-form-control i18n-nzErrorTip nzErrorTip="You must enter name.">
              <input
                nz-input
                i18n-placeholder
                placeholder="Title"
                nzSize="large"
                [formControl]="nameControl"
              />
            </nz-form-control>
          </nz-form-item>
          <div class="flex space-x-4 grow">
            <nz-form-item class="w-full floating-title" [ngClass]="endControl.value ? 'value' : ''">
              <nz-form-label i18n>End</nz-form-label>
              <nz-form-control i18n-nzErrorTip nzErrorTip="End Date is required.">
                <nz-date-picker
                  [nzShowTime]="{ nzFormat: 'HH:mm', nzMinuteStep: 5, nzHideDisabledOptions: true }"
                  class="flex grow"
                  nzSize="large"
                  nzShowTime
                  nzFormat="yyyy-MM-dd HH:mm:ss"
                  [formControl]="endControl"
                  i18n-nzPlaceHolder
                  nzPlaceHolder="End"
                ></nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>
          <nz-form-item class="floating-title" [ngClass]="descriptionControl.value ? 'value' : ''">
            <nz-form-label i18n>Description</nz-form-label>
            <nz-form-control>
              <textarea
                nz-input
                nzSize="large"
                i18n-placeholder
                placeholder="Description"
                rows="4"
                [formControl]="descriptionControl"
              ></textarea>
            </nz-form-control>
          </nz-form-item>
        </nz-card>

        <nz-card>
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Badge definition"
            i18n-nzDescription
            nzDescription="Title and description will be included on the badge."
          >
          </nz-card-meta>
          <div class="mt-4 space-y-4">
            <nz-form-item class="floating-title" [ngClass]="badgeNameControl.value ? 'value' : ''">
              <nz-form-label i18n>Title</nz-form-label>
              <nz-form-control i18n-nzErrorTip nzErrorTip="Title is required.">
                <input
                  nz-input
                  nzSize="large"
                  i18n-placeholder
                  placeholder="Title"
                  [formControl]="badgeNameControl"
                />
              </nz-form-control>
            </nz-form-item>
            <nz-form-item
              class="floating-title"
              [ngClass]="badgeDescriptionControl.value ? 'value' : ''"
            >
              <nz-form-label i18n>Description</nz-form-label>
              <nz-form-control>
                <textarea
                  nz-input
                  nzSize="large"
                  i18n-placeholder
                  placeholder="Badge description"
                  rows="4"
                  [formControl]="badgeDescriptionControl"
                ></textarea>
              </nz-form-control>
            </nz-form-item>
          </div>
        </nz-card>
      </div>

      <div
        class="mt-4 space-y-4 lg:mt-0 lg:max-w-450"
        nz-col
        [nzFlex]="(deviceService.isDesktop$ | async) ? '450px' : 'auto'"
      >
        <nz-card [nzBordered]="false">
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Space Info"
            i18n-nzDescription
            nzDescription="This is the space that will list the award."
          >
          </nz-card-meta>
          <nz-form-item class="mt-4">
            <nz-form-control i18n-nzErrorTip nzErrorTip="Space is required.">
              <nz-select
                class="w-full"
                nzSize="large"
                nzShowSearch
                [nzCustomTemplate]="selectTpl"
                nzAllowClear
                [nzPlaceHolder]="placeholderTpl"
                [formControl]="spaceControl"
              >
                <nz-option
                  *ngFor="let s of spaces$ | async; trackBy: trackByUid"
                  nzCustomContent
                  [nzLabel]="s.name || s.uid"
                  [nzValue]="s.uid"
                >
                  <nz-avatar
                    [nzSrc]="previewImageService.getAvatarSize(s.avatarUrl)"
                    [nzSize]="32"
                    class="mr-3 border-2 border-foregrounds-tertiary dark:border-foregrounds-tertiary-dark"
                    nzShape="circle"
                  >
                  </nz-avatar>
                  {{s.name || s.uid}}
                </nz-option>
              </nz-select>
              <ng-template #placeholderTpl>
                <div class="flex items-center space-x-4">
                  <wen-icon-globe
                    class="text-foregrounds-primary dark:text-foregrounds-primary-dark"
                  ></wen-icon-globe>
                  <span i18n>Select a space</span>
                </div>
              </ng-template>
              <ng-template #selectTpl let-s>
                <div class="flex items-center space-x-4">
                  <wen-icon-globe
                    class="text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
                  ></wen-icon-globe>
                  <span>{{ s.nzLabel }}</span>
                </div>
              </ng-template>
            </nz-form-control>
          </nz-form-item>
        </nz-card>

        <nz-card [nzBordered]="false">
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Reward info"
            i18n-nzDescription
            nzDescription="Defines the amount of XP for each badge and the number of badges available."
          >
          </nz-card-meta>
          <nz-form-item class="mt-6 grow">
            <nz-form-control i18n-nzErrorTip nzErrorTip="Invalid xp per badge">
              <nz-input-group nzSize="large" [nzPrefix]="prefixIotaPerBadge">
                <input
                  nz-input
                  type="number"
                  class="w-full"
                  nz-input
                  i18n-placeholder
                  placeholder="iXP per badge"
                  [formControl]="badgeXpControl"
                />
                <ng-template #prefixIotaPerBadge>
                  <wen-icon-iota></wen-icon-iota>
                </ng-template>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
          <div class="flex items-baseline">
            <nz-form-item class="grow">
              <nz-form-control i18n-nzErrorTip nzErrorTip="Minimum 1 and maximum 10000.">
                <nz-input-group nzSize="large" [nzPrefix]="prefixBadgesAmount">
                  <input
                    nz-input
                    type="number"
                    class="w-full"
                    nzSize="large"
                    i18n-placeHolder
                    placeholder="Number of Badges"
                    [formControl]="badgeCountControl"
                  />
                  <ng-template #prefixBadgesAmount>
                    <wen-icon-award></wen-icon-award>
                  </ng-template>
                </nz-input-group>
              </nz-form-control>
            </nz-form-item>
            <wen-icon-question-circle
              class="ml-3 text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
              nz-tooltip
              nzTooltipPlacement="right"
              i18n-nzTooltipTitle
              nzTooltipTitle="The amount of badges you want to make available for this award. This can also be thought of as how many awards you want to give out."
            ></wen-icon-question-circle>
          </div>

          <div
            class="px-6 py-2 font-medium rounded-3xl bg-backgrounds-secondary dark:bg-backgrounds-secondary-dark"
          >
            <div
              class="text-xs text-foregrounds-secondary dark:text-foregrounds-secondary-dark"
              i18n
            >
              Total iXP
            </div>
            <div>{{ getTotalXp() || '-' }}</div>
          </div>
        </nz-card>

        <nz-card [nzBordered]="false">
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Badge"
            i18n-nzDescription
            nzDescription="What the badge looks like."
          >
          </nz-card-meta>

          <div
            class="flex p-4 mt-4 space-x-4 bg-accent-selected dark:bg-accent-selected-dark text-foregrounds-primary dark:text-foregrounds-primary-dark"
            *ngIf="!imageControl.value"
          >
            <wen-icon-award></wen-icon-award>
            <span i18n>Generate a unique badge.</span>
            <button nz-button nzSize="small" nzType="primary" type="button" (click)="mint()" i18n>
              Generate Badge
            </button>
          </div>

          <div
            class="flex p-4 space-x-4 bg-accent-selected dark:bg-accent-selected-dark text-foregrounds-primary dark:text-foregrounds-primary-dark"
            *ngIf="imageControl.value"
          >
            <nz-avatar
              class="border-2 border-foregrounds-tertiary dark:border-foregrounds-tertiary-dark min-w-max"
              [nzSize]="48"
              [nzSrc]="imageControl.value | ipfsAvatar:filesizes.small"
            ></nz-avatar>
            <span i18n>WOW! Now reward your members with it! </span>
          </div>
        </nz-card>

        <nz-card [nzBordered]="false">
          <nz-card-meta
            i18n-nzTitle
            nzTitle="Award Setup"
            i18n-nzDescription
            nzDescription="Defines who and how can get a badge."
          >
          </nz-card-meta>
          <nz-form-item class="mt-4">
            <nz-form-control>
              <nz-radio-group class="wen-radio-group" [formControl]="typeControl">
                <wen-radio [value]="types.PARTICIPATE_AND_APPROVE">
                  <span
                    class="inline-flex items-center text-foregrounds-primary dark:text-foregrounds-primary-dark"
                    ><span i18n>Guardian approval</span>
                    <wen-icon-question-circle
                      class="inline-block h-max"
                      nz-tooltip
                      nzTooltipPlacement="right"
                      i18n-nzTooltipTitle
                      nzTooltipTitle="The award must be approved by the guardians of the space before it's active or distributed"
                    >
                    </wen-icon-question-circle> </span
                ></wen-radio>
              </nz-radio-group>
            </nz-form-control>
          </nz-form-item>
        </nz-card>
      </div>
    </div>

    <button
      nz-button
      class="w-full mt-8 lg:w-auto mb-18 lg:mb-6 lg:mt-0"
      nzType="primary"
      nzSize="large"
      type="button"
      (click)="create()"
      i18n
    >
      Create award
    </button>
  </form>
</wen-content>
