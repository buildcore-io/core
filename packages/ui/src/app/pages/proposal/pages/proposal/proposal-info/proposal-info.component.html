<nz-card
  i18n-nzTitle
  [nzTitle]="
    (deviceService.isDesktop$ | async)
      ? 'Casted Votes'
      : 'Votes (' + ((data.transactions$ | async) || []).length + ')'
  "
  class="block"
  *ngIf="
    (data?.proposal$ | async)?.approved &&
    helper?.isMemberVote((data?.proposal$ | async)?.type) &&
    !helper?.isPending(data?.proposal$ | async)
  "
>
  <nz-table #basicTable [nzData]="(data.transactions$ | async) || []" [nzShowPagination]="false">
    <thead>
      <tr>
        <th i18n>Voter</th>
        <th i18n>Date</th>
        <th i18n>Option</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let t of data?.transactions$ | async">
        <td class="cursor-pointer" [routerLink]="['/', 'member', t.member]">
          @{{ t.memberRec?.name || t.member | truncate : [7] }}
        </td>
        <td>{{ t.createdOn?.toDate() | date : 'short' }}</td>
        <td>{{ helper.findAnswerText((data.proposal$ | async)?.questions, t.payload.values) }}</td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>

<nz-card
  nzTitle="Approve Proposal"
  class="block"
  *ngIf="
    !(data?.proposal$ | async)?.approved &&
    (isGuardianWithinSpace$ | async) &&
    !(data?.proposal$ | async)?.rejected
  "
>
  <div class="mb-8 space-y-4">
    <button nz-button nzType="primary" nzBlock nzSize="large" (click)="wenOnApprove.emit()" i18n>
      Approve
    </button>
    <button
      nz-button
      nzDanger
      nzType="primary"
      nzBlock
      nzSize="large"
      (click)="wenOnReject.emit()"
      i18n
    >
      Decline
    </button>
  </div>
</nz-card>

<nz-card nzTitle="Proposal Info" class="block">
  <wen-description
    [items]="[
      helper.isNativeVote((data.proposal$ | async)?.type)
        ? { title: descriptionLabels[0], value: (data.lastMilestone$ | async)?.cmi }
        : null,
      helper.isNativeVote((data.proposal$ | async)?.type)
        ? {
            title: descriptionLabels[1],
            value:
              (helper.getCommenceDate(
                data.proposal$ | async,
                (data.lastMilestone$ | async) || undefined
              ) | date : 'short'),
            titleTemplate: commenceDateTooltipIcon
          }
        : null,
      {
        title: descriptionLabels[2],
        value:
          (helper.getStartDate(data.proposal$ | async, (data.lastMilestone$ | async) || undefined)
          | date : 'short'),
        titleTemplate: startDateTooltipIcon
      },
      {
        title: descriptionLabels[3],
        value:
          (helper.getEndDate(data.proposal$ | async, (data.lastMilestone$ | async) || undefined)
          | date : 'short'),
        titleTemplate: endDateTooltipIcon
      },
      {
        title: descriptionLabels[4],
        value: helper.getVotingTypeText((data.proposal$ | async)?.subType),
        titleTemplate: votingTypeTooltipIcon
      },
      helper.isMemberVote((data.proposal$ | async)?.type)
        ? {
            title: descriptionLabels[5],
            value: (data.proposal$ | async)?.totalWeight || 0,
            titleTemplate: totalWeightTooltipIcon
          }
        : null
    ]"
  ></wen-description>
  <ng-template #commenceDateTooltipIcon>
    <wen-icon-question-circle
      nz-tooltip
      i18n-nzTooltipTitle
      [nzTooltipTitle]="'Milestone ' + (data.proposal$ | async)?.settings?.milestoneIndexCommence"
    >
    </wen-icon-question-circle>
  </ng-template>
  <ng-template #startDateTooltipIcon>
    <wen-icon-question-circle
      *ngIf="helper.isNativeVote((data.proposal$ | async)?.type)"
      nz-tooltip
      i18n-nzTooltipTitle
      [nzTooltipTitle]="'Milestone ' + (data.proposal$ | async)?.settings?.milestoneIndexStart"
    >
    </wen-icon-question-circle>
  </ng-template>
  <ng-template #endDateTooltipIcon>
    <wen-icon-question-circle
      *ngIf="helper.isNativeVote((data.proposal$ | async)?.type)"
      nz-tooltip
      i18n-nzTooltipTitle
      [nzTooltipTitle]="'Milestone ' + (data.proposal$ | async)?.settings?.milestoneIndexEnd"
    >
    </wen-icon-question-circle>
  </ng-template>
  <ng-template #votingTypeTooltipIcon>
    <wen-icon-question-circle
      nz-tooltip
      i18n-nzTooltipTitle
      nzTooltipTitle="Voting Type of this proposal."
    >
    </wen-icon-question-circle>
  </ng-template>
  <ng-template #totalWeightTooltipIcon>
    <wen-icon-question-circle
      nz-tooltip
      i18n-nzTooltipTitle
      nzTooltipTitle="Total weight within this proposal for all participants."
    >
    </wen-icon-question-circle>
  </ng-template>

  <a
    nz-button
    (click)="wenOnExportClick.emit()"
    *ngIf="helper.isNativeVote((data.proposal$ | async)?.type)"
    nzType="link"
    i18n
    >Export to JSON</a
  >
</nz-card>
